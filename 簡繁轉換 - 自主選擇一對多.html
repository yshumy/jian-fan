<!DOCTYPE html> <!-- HTML5 文件類型宣告 -->
<html lang="zh-CN"> <!-- 設定頁面語言為簡體中文 -->

<head>
    <meta charset="UTF-8"> <!-- 設定字符編碼為 UTF-8，確保文字正確顯示 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- 設定響應式視窗，確保網頁在不同設備上良好顯示 -->
    <title>半自動簡繁轉換 - 自主選擇一對多</title> <!-- 頁面標題 -->
    <style>
        /* CSS 變數定義 */
        :root {
            /* 亮白主題預設值 - 極深灰度層次系統 */
            --background-color: #94a3b8;
            --text-color: #0f172a;
            --header-color: #020617;
            --subtitle-color: #334155;
            --panel-background: rgba(203, 213, 225, 0.9);
            --panel-border: rgba(71, 85, 105, 0.4);
            --feature-background: rgba(148, 163, 184, 0.8);
            --feature-border-left: #3b82f6;
            --feature-title-color: #1e40af;
            --footer-border-top: #475569;
            --label-color: #1e293b;
            --label-block-color-input: #3b82f6;
            --label-block-color-result: #059669;
            --label-block-color-final: #5b21b6;
            --label-block-color-disambiguation: #d97706;
            --textarea-background: #cbd5e1;
            --textarea-border: #475569;
            --textarea-focus-border: #3b82f6;
            --select-border: #dc2626;
            --select-focus-border: #3b82f6;
            --select-focus-shadow: rgba(59, 130, 246, 0.2);
            --select-color: #dc2626;
            --select-arrow-color: #dc2626;
            --fixed-choice-color: #059669;
            --disambiguation-content-color: #475569;
            --disambiguation-title-color: #1e293b;
            --copy-message-background: rgba(30, 41, 59, 0.9);
            --copy-message-color: #c0c0c0;

            /* 主題切換按鈕新變數 */
            --theme-button-bg-light: #ffffff;
            /* 太陽圖案背景 */
            --theme-button-color-light: #ff6600;
            /* 太陽圖案顏色 */
            --theme-button-bg-dark: #000000;
            /* 月亮圖案背景 */
            --theme-button-color-dark: #007bff;
            /* 月亮圖案顏色 */
            --theme-button-border: #ffffff;
        }

        /* 暗黑主題樣式 */
        body.dark-theme {
            --background-color: #0f172a;
            --text-color: #e2e8f0;
            --header-color: #f1f5f9;
            --subtitle-color: #94a3b8;
            --panel-background: rgba(30, 41, 59, 0.95);
            --panel-border: rgba(71, 85, 105, 0.3);
            --feature-background: rgba(51, 65, 85, 0.9);
            --feature-border-left: #60a5fa;
            --feature-title-color: #93c5fd;
            --footer-border-top: #374151;
            --label-color: #cbd5e1;
            --label-block-color-input: #60a5fa;
            --label-block-color-result: #34d399;
            --label-block-color-final: #a78bfa;
            --label-block-color-disambiguation: #fbbf24;
            --textarea-background: #1e293b;
            --textarea-border: #475569;
            --textarea-focus-border: #60a5fa;
            --select-border: #dc2626;
            --select-focus-border: #60a5fa;
            --select-focus-shadow: rgba(96, 165, 250, 0.2);
            --select-color: #dc2626;
            --select-arrow-color: #dc2626;
            --fixed-choice-color: #34d399;
            --disambiguation-content-color: #d1d5db;
            --disambiguation-title-color: #f9fafb;
            --copy-message-background: rgba(15, 23, 42, 0.9);
            --copy-message-color: #e2e8f0;

            /* 暗黑主題下的主題切換按鈕顏色 */
            --theme-button-bg-light: #ffffff;
            /* 太陽圖案背景 */
            --theme-button-color-light: #ff6600;
            /* 太陽圖案顏色 */
            --theme-button-bg-dark: #000000;
            /* 月亮圖案背景 */
            --theme-button-color-dark: #007bff;
            /* 月亮圖案顏色 */
            --theme-button-border: #ffffff;
        }

        /* 全局重置與基礎樣式 */
        * {
            box-sizing: border-box;
            /* 盒模型包含邊框和內邊距，使佈局更易控制 */
            margin: 0;
            /* 重置所有元素的外邊距 */
            padding: 0;
            /* 重置所有元素的內邊距 */
        }

        html,
        body {
            height: 100%;
            /* 使 html 和 body 元素佔據整個視窗高度 */
            margin: 0;
            /* 重置外邊距 */
            overflow: hidden;
            /* 隱藏 body 的滾動條，讓內部容器控制滾動 */
        }

        body {
            font-family: '正楷';
            /* 設定字體族，優先使用, '楷体-繁', '楷体-简' */
            background-color: var(--background-color);
            /* 使用 CSS 變數 */
            color: var(--text-color);
            /* 使用 CSS 變數 */
            line-height: 1.4;
            /* 行高設定為 1.4 倍，提高可讀性 */
            display: flex;
            /* 使用 Flexbox 佈局 */
            flex-direction: column;
            /* 子元素垂直堆疊 */
            align-items: center;
            /* 內容水平居中對齊 */
            padding: 3px;
            /* 內邊距設定為 3px */
            transition: background-color 0.3s ease, color 0.3s ease;
            /* 主題切換過渡效果 */
        }

        /* 主題切換按鈕容器 */
        .theme-toggle-container {
            position: absolute;
            /* 絕對定位 */
            top: 10px;
            /* 距離頂部 5px */
            left: 9px;
            /* 距離左側 5px */
            z-index: 1001;
            /* 確保按鈕在最上層 */
        }

        /* Github 按鈕容器 */
        .github-button-container {
            position: absolute;
            /* 絕對定位 */
            top: 10px;
            /* 距離頂部 10px */
            right: 9px;
            /* 距離右側 9px */
            z-index: 1001;
            /* 確保按鈕在最上層 */
        }

        .github-btn {
            display: flex;
            /* 使用 Flexbox 佈局 */
            width: 50px;
            /* 按鈕總寬度 */
            height: 25px;
            /* 按鈕總高度 */
            border: 0.2px solid #ffffff;
            /* 黑框 */
            border-radius: 3px;
            /* 圓角形狀 */
            overflow: hidden;
            /* 隱藏超出部分 */
            cursor: pointer;
            padding: 0;
            /* 移除預設內邊距 */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: #000444;
            /* 深藍底 */
            color: #ffffff;
            /* 白字 */
            align-items: center;
            justify-content: center;
            font-size: 12px;
            /* 字體大小 */
            text-decoration: none;
            /* 移除下劃線 */
        }



        .theme-toggle-btn {
            display: flex;
            /* 使用 Flexbox 佈局 */
            width: 50px;
            /* 按鈕總寬度 */
            height: 25px;
            /* 按鈕總高度 */
            border: 0.2px solid var(--theme-button-border);
            border-radius: 3px;
            /* 圓角膠囊形狀 */
            overflow: hidden;
            /* 隱藏超出部分 */
            cursor: pointer;
            padding: 0;
            /* 移除預設內邊距 */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .theme-toggle-btn>span {
            flex: 1;
            /* 平均分配空間 */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            /* 圖示大小 */
            line-height: 1;
            /* 確保圖示垂直居中 */
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* 默認（亮白）主題下的按鈕樣式 */
        .theme-toggle-btn .sun-icon {
            background-color: var(--theme-button-bg-light);
            color: var(--theme-button-color-light);
            /* 太陽圖案顏色 */
        }

        .theme-toggle-btn .moon-icon {
            background-color: var(--theme-button-bg-dark);
            color: var(--theme-button-color-dark);
            /* 月亮圖案顏色 */
        }

        /* 亮白主題下的按鈕樣式 */
        body.light-theme .theme-toggle-btn .sun-icon {
            background-color: var(--theme-button-bg-light);
            color: var(--theme-button-color-light);
            /* 太陽圖案顏色 */
        }

        body.light-theme .theme-toggle-btn .moon-icon {
            background-color: var(--theme-button-bg-dark);
            color: var(--theme-button-color-dark);
            /* 月亮圖案顏色 */
        }

        /* 暗黑主題下的按鈕樣式 */
        body.dark-theme .theme-toggle-btn .sun-icon {
            background-color: var(--theme-button-bg-light);
            color: var(--theme-button-color-light);
            /* 太陽圖案顏色 */
        }

        body.dark-theme .theme-toggle-btn .moon-icon {
            background-color: var(--theme-button-bg-dark);
            color: var(--theme-button-color-dark);
            /* 月亮圖案顏色 */
        }

        /* 整體包裝器，用於限制最大寬度和居中 */
        .overall-wrapper {
            width: 100%;
            /* 寬度設定為 100% */
            display: flex;
            /* 使用 Flexbox 佈局 */
            flex-direction: column;
            /* 子元素垂直排列 */
            gap: 3px;
            /* 子元素之間的間距設定為 3px */
            flex-grow: 1;
            /* 允許整體容器填充可用垂直空間 */
            overflow: hidden;
            /* 隱藏整體容器的滾動條，讓內部面板控制滾動 */
        }

        /* 標題樣式 */
        header {
            text-align: center;
            /* 文字置中對齊 */
            color: var(--header-color);
            /* 使用 CSS 變數 */
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            /* 文字陰影效果 */
            flex-shrink: 0;
            /* 防止空間不足時標題縮小 */
        }

        h1 {
            color: var(--header-color);
            /* 使用 CSS 變數 */
            font-size: 1.5em;
            /* 稍小的標題字體大小 */
            margin-bottom: 0px;
            /* 進一步減少標題底部邊距 */
            padding-bottom: 0px;
            /* 移除底部內邊距 */
            text-decoration: underline;
            /* 使用文字底線 */
            text-decoration-color: #05009e;
            /* 底線顏色 */
            text-decoration-thickness: 0.5px;
            /* 更細的底線 */
            text-underline-offset: 5px;
            /* 增加底線偏移以獲得更多分隔 */
        }

        .subtitle {
            color: var(--subtitle-color);
            /* 使用 CSS 變數 */
            font-size: 1.2em;
            /* 副標題字體大小 */
            max-width: 600px;
            /* 最大寬度限制 */
            margin: 0 auto;
            /* 水平居中 */
        }

        /* 主內容網格佈局 */
        .main-content-grid {
            display: grid;
            /* 使用網格佈局 */
            grid-template-columns: 1fr 2fr 1fr;
            /* 調整為 1:2:1 比例（移除了消歧面板列） */
            gap: 3px;
            /* 網格間距設定為 3px */
            width: 100%;
            /* 寬度設定為 100% */
            flex-grow: 1;
            /* 允許網格填充可用垂直空間 */
            align-items: stretch;
            /* 使網格項目垂直拉伸以填充其單元格 */
            min-height: 0;
            /* 允許網格項目在需要時縮小 */
        }

        /* 左、中、右面板的通用樣式 */
        .left-panel,
        .middle-panel,
        .right-panel {
            background: var(--panel-background);
            /* 使用 CSS 變數 */
            padding: 8px;
            /* 面板內邊距設定為 8px */
            border-radius: 4px;
            /* 統一邊框圓角 */
            border: 0.5px solid var(--panel-border);
            /* 統一邊框樣式 */
            display: flex;
            /* 使用 Flexbox 進行內部佈局 */
            flex-direction: column;
            /* 子元素垂直排列 */
            gap: 4px;
            /* 面板內部部分之間的間距設定為 4px */
            min-height: 0;
            /* 允許 flex 項目在需要時縮小到小於其內容大小 */
            overflow: hidden;
            /* 隱藏面板自身的滾動條，讓內部內容區域控制滾動 */
            transition: all 0.3s ease;
            /* 統一過渡效果 */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            /* 統一陰影效果 */
        }

        /* 左面板內容樣式 */
        .left-panel {
            flex-grow: 1;
            /* 允許左面板填充主網格中的垂直空間 */
        }

        .left-top-section {
            display: flex;
            /* 使用 Flexbox 佈局 */
            flex-direction: column;
            /* 子元素垂直排列 */
            gap: 2px;
            /* 子元素間距設定為 2px */
            flex-shrink: 0;
            /* 防止空間不足時此部分縮小 */
        }

        /* 功能點 */
        .feature-points {
            margin-top: auto;
            /* 將元素推到底部 */
            flex-shrink: 0;
            /* 防止縮小 */
            background: var(--feature-background);
            /* 使用 CSS 變數 */
            border-radius: 4px;
            /* 邊框圓角設定為 4px */
            padding: 6px;
            /* 內邊距設定為 6px */
            border-left: 2px solid var(--feature-border-left);
            /* 使用 CSS 變數 */
            transition: background 0.3s ease, border-color 0.3s ease;
            /* 主題切換過渡效果 */
        }

        .feature {
            min-width: unset;
            /* 移除舊的最小寬度限制 */
            width: 100%;
            /* 佔據整個面板寬度 */
        }

        .feature h3 {
            color: var(--feature-title-color);
            /* 使用 CSS 變數 */
            margin-bottom: 0px;
            /* 底部邊距設定為 0 */
            display: flex;
            /* 使用 Flexbox 佈局 */
            align-items: center;
            /* 垂直居中對齊 */
            gap: 2px;
            /* 子元素間距設定為 2px */
            transition: color 0.3s ease;
            /* 主題切換過渡效果 */
        }

        .feature p {
            font-size: 14px;
            /* 功能描述字體大小設定為 16px */
        }

        /* 為功能標題添加色塊 */
        .feature h3::before {
            content: '';
            /* 空內容 */
            display: inline-block;
            /* 行內塊元素 */
            width: 16px;
            /* 寬度設定為 16px */
            height: 16px;
            /* 高度設定為 16px */
            border-radius: 3px;
            /* 邊框圓角設定為 3px */
            margin-right: 2px;
            /* 右外邊距設定為 2px */
            background-color: var(--feature-border-left);
            /* 使用 CSS 變數 */
            flex-shrink: 0;
            /* 防止縮小 */
            transition: background-color 0.3s ease;
            /* 主題切換過渡效果 */
        }

        /* 為不同功能標題指定不同的色塊顏色 */
        .feature:nth-child(1) h3::before {
            background-color: #28a745;
        }

        /* 第一個功能：綠色 */
        .feature:nth-child(2) h3::before {
            background-color: #007bff;
        }

        /* 第二個功能：藍色 */
        .feature:nth-child(3) h3::before {
            background-color: #ffc107;
        }

        .info-badge {
            background: #1a2980;
            /* 背景色設定為藍色 */
            color: white;
            /* 文字顏色設定為白色 */
            border-radius: 50%;
            /* 邊框圓角設定為 50%（圓形） */
            width: 20px;
            /* 寬度設定為 20px */
            height: 20px;
            /* 高度設定為 20px */
            display: inline-flex;
            /* 行內 flex 佈局 */
            align-items: center;
            /* 垂直居中對齊 */
            justify-content: center;
            /* 水平居中對齊 */
            font-size: 16px;
            /* 字體大小設定為 16px */
            margin-left: 6px;
            /* 左外邊距設定為 2px */
            cursor: help;
            /* 滑鼠游標設定為幫助樣式 */
        }

        .highlight-example {
            background-color: rgba(255, 193, 7, 0.2);
            /* 淺黃色半透明背景 */
            padding: 2px 2px;
            /* 內邊距設定為 2px */
            border-radius: 3px;
            /* 邊框圓角設定為 3px */
            margin: 1px 1px;
            /* 外邊距設定為 1px */
        }

        /* 功能介紹頁腳樣式 */
        .footer {
            margin-top: auto;
            /* 將頁腳推至左面板底部 */
            padding-top: 2px;
            /* 頂部內邊距設定為 2px */
            border-top: 1.0px solid var(--footer-border-top);
            /* 使用 CSS 變數 */
            line-height: 1.4;
            /* 行高設定為 1.4 倍 */
            text-align: center;
            /* 文字置中對齊 */
            color: var(--subtitle-color);
            /* 使用 CSS 變數 */
            font-size: 16px;
            /* 字體大小設定為 16px */
            flex-shrink: 0;
            /* 防止空間不足時頁腳縮小 */
            transition: border-color 0.3s ease, color 0.3s ease;
            /* 主題切換過渡效果 */
        }

        /* 通用動作按鈕樣式 */
        .action-btn {
            color: white;
            /* 文字顏色設定為白色 */
            border: none;
            /* 移除邊框 */
            border-radius: 3px;
            /* 邊框圓角設定為 3px */
            padding: 2px 8px;
            /* 內邊距設定為垂直 2px，水平 8px */
            font-size: 12px;
            /* 字體大小設定為 12px */
            cursor: pointer;
            /* 滑鼠游標設定為指標樣式 */
            transition: all 0.3s ease;
            /* 所有屬性 0.3 秒緩動過渡效果 */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            /* 陰影效果 */
            display: inline-flex;
            /* 行內 flex 佈局 */
            align-items: center;
            /* 垂直居中對齊 */
            justify-content: center;
            /* 水平居中對齊 */
            gap: 4px;
            /* 子元素間距設定為 4px */
        }

        .action-btn:hover {
            transform: translateY(-1px);
            /* 滑鼠懸停時向上移動 1px */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
            /* 增強陰影效果 */
        }

        /* 禁用按鈕樣式 */
        .action-btn:disabled {
            opacity: 0.5;
            /* 透明度設定為 50% */
            cursor: not-allowed;
            /* 滑鼠游標設定為禁止樣式 */
            transform: none;
            /* 移除變換效果 */
            box-shadow: none;
            /* 移除陰影效果 */
        }

        /* 特定按鈕樣式（僅顏色） */
        .reset-btn {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
            /* 重置按鈕：紅色漸層背景 */
        }

        .clear-button {
            background: #6c757d;
            /* 清空按鈕：灰色背景 */
        }

        .copy-button {
            background: linear-gradient(to right, #007bff, #0056b3);
            /* 複製按鈕：藍色漸層背景 */
        }

        /* 撤銷/重做按鈕樣式 */
        .undo-btn {
            background: linear-gradient(to right, #0088ff, #000000);
            /* 撤銷按鈕：灰色漸層背景 */
        }

        .redo-btn {
            background: linear-gradient(to right, #001306, #007f92);
            /* 重做按鈕：青綠色漸層背景 */
        }

        /* 輸入區域樣式 */
        .input-area {
            margin-bottom: 0;
            /* 移除舊的底部邊距 */
            flex-shrink: 0;
            /* 防止空間不足時輸入區域縮小 */
        }

        .input-area-header {
            display: flex;
            /* 使用 Flexbox 佈局 */
            justify-content: space-between;
            /* 兩端對齊 */
            align-items: center;
            /* 垂直居中對齊 */
            margin-bottom: 3px;
            /* 底部邊距設定為 3px */
        }

        label {
            color: var(--label-color);
            /* 使用 CSS 變數 */
            display: flex;
            /* 使用 Flexbox 佈局 */
            align-items: center;
            /* 垂直居中對齊 */
            gap: 5px;
            /* 子元素間距設定為 5px */
            transition: color 0.3s ease;
            /* 主題切換過渡效果 */
        }

        /* 為標籤添加色塊 */
        label::before {
            content: '';
            /* 空內容 */
            display: inline-block;
            /* 行內塊元素 */
            width: 16px;
            /* 寬度設定為 16px */
            height: 16px;
            /* 高度設定為 16px */
            border-radius: 3px;
            /* 邊框圓角設定為 2px */
            margin-right: 2px;
            /* 右外邊距設定為 2px */
            background-color: var(--label-block-color-input);
            /* 預設顏色使用 CSS 變數 */
            flex-shrink: 0;
            /* 防止縮小 */
            transition: background-color 0.3s ease;
            /* 主題切換過渡效果 */
        }

        /* 為不同標籤指定不同的色塊顏色 */
        .input-area label::before {
            background-color: var(--label-block-color-input);
        }

        /* 輸入文字標籤：藍色 */
        .result-header label::before {
            background-color: var(--label-block-color-result);
        }

        /* 結果區域標籤：綠色 */
        .result-container .copy-button-container label::before {
            background-color: var(--label-block-color-final);
        }

        /* 最終結果標籤：深藍色 */
        .disambiguation-panel label::before {
            background-color: var(--label-block-color-disambiguation);
        }

        /* 字義辨析面板標籤：黃色 */

        textarea {
            width: 100%;
            /* 寬度設定為 100% */
            padding: 2px;
            /* 內邊距設定為 2px */
            border-radius: 3px;
            /* 邊框圓角設定為 3px */
            border: 0.5px solid var(--textarea-border);
            /* 使用 CSS 變數 */
            font-size: 16px;
            /* 字體大小設定為 16px */
            line-height: 1.4;
            /* 行高設定為 1.4 倍 */
            min-height: 80px;
            /* 最小高度設定為 80px，約顯示 3 行內容 */
            resize: vertical;
            /* 允許垂直調整大小 */
            transition: all 0.3s;
            /* 所有屬性 0.3 秒過渡效果 */
            background: var(--textarea-background);
            /* 使用 CSS 變數 */
            color: var(--text-color);
            /* 使用 CSS 變數 */
            box-shadow: inset 0 0.5px 1.5px rgba(0, 0, 0, 0.03);
            /* 內陰影效果 */
        }

        textarea:focus {
            border-color: var(--textarea-focus-border);
            /* 聚焦時邊框顏色使用 CSS 變數 */
            outline: none;
            /* 移除預設外框 */
            background: var(--panel-background);
            /* 聚焦時背景色使用 CSS 變數 */
        }

        /* 轉換按鈕群組樣式 */
        .controls {
            display: flex;
            /* 使用 Flexbox 佈局 */
            gap: 2px;
            /* 按鈕間距設定為 2px */
            margin-bottom: 0;
            /* 移除舊的底部邊距 */
            flex-shrink: 0;
            /* 防止空間不足時按鈕區域縮小 */
        }

        .btn {
            flex: 1;
            /* 彈性佈局，平均分配空間 */
            padding: 2px 2px;
            /* 內邊距設定為 2px */
            font-size: 16px;
            /* 字體大小設定為 16px */
            color: white;
            /* 文字顏色設定為白色 */
            border: none;
            /* 移除邊框 */
            border-radius: 3px;
            /* 邊框圓角設定為 3px */
            cursor: pointer;
            /* 滑鼠游標設定為指標樣式 */
            transition: all 0.3s;
            /* 所有屬性 0.3 秒過渡效果 */
            display: flex;
            /* 使用 Flexbox 佈局 */
            align-items: center;
            /* 垂直居中對齊 */
            justify-content: center;
            /* 水平居中對齊 */
            gap: 2px;
            /* 圖示與文字間距設定為 2px */
        }

        .btn:hover {
            transform: translateY(-1px);
            /* 滑鼠懸停時向上移動 1px */
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            /* 增強陰影效果 */
        }

        .btn:active {
            transform: translateY(0.5px);
            /* 點擊時向下移動 0.5px */
            box-shadow: 0 0.5px 2px rgba(0, 0, 0, 0.1);
            /* 減弱陰影效果 */
        }

        .btn-to-trad {
            background: linear-gradient(to right, #1e3c72, #2a5298);
            /* 簡轉繁按鈕：藍色漸層背景 */
        }

        .btn-to-sim {
            background: linear-gradient(to right, #0f9b0f, #20bf55);
            /* 繁轉簡按鈕：綠色漸層背景 */
        }

        /* 異體字排除控制樣式 */
        .variant-exclusion-container {
            display: flex;
            /* 使用 Flexbox 佈局 */
            justify-content: center;
            /* 水平居中 */
            margin-top: 4px;
            /* 頂部邊距 */
            flex-shrink: 0;
            /* 防止空間不足時縮小 */
        }

        .variant-exclusion-label {
            display: flex;
            /* 使用 Flexbox 佈局 */
            align-items: center;
            /* 垂直居中對齊 */
            gap: 6px;
            /* 勾選框與文字間距 */
            font-size: 14px;
            /* 字體大小 */
            cursor: pointer;
            /* 滑鼠游標設定為指標樣式 */
            color: var(--text-color);
            /* 使用 CSS 變數 */
            transition: color 0.3s ease;
            /* 主題切換過渡效果 */
        }

        .variant-exclusion-label::before {
                display: none;
        }

        .variant-exclusion-checkbox {
            width: 16px;
            /* 寬度 */
            height: 16px;
            /* 高度 */
            cursor: pointer;
            /* 滑鼠游標設定為指標樣式 */
            accent-color: var(--feature-border-left);
            /* 勾選框顏色使用主題色 */
        }

        /* 結果區域樣式 */
        .result-container {
            margin-top: 0;
            /* 移除舊的頂部邊距 */
            padding-top: 0;
            /* 移除舊的頂部內邊距 */
            border-top: none;
            /* 移除舊的頂部邊框 */
            flex-grow: 1;
            /* 允許結果容器填充中間面板的可用空間 */
            display: flex;
            /* 設定為 flex 容器 */
            flex-direction: column;
            /* 子元素垂直堆疊 */
            min-height: 0;
            /* 允許 flex 項目縮小 */
        }

        .result-header {
            display: flex;
            /* 使用 Flexbox 佈局 */
            justify-content: space-between;
            /* 兩端對齊 */
            align-items: center;
            /* 垂直居中對齊 */
            margin-bottom: 3px;
            /* 底部邊距設定為 3px */
            flex-shrink: 0;
            /* 防止空間不足時標題縮小 */
        }

        /* 互動結果區 */
        #interactive-result {
            width: 100%;
            /* 寬度設定為 100% */
            flex-grow: 1;
            /* 允許互動結果區域填充容器的可用空間 */
            min-height: 80px;
            /* 最小高度與輸入框保持一致 */
            overflow: auto;
            /* 自動滾動條 */
            padding: 2px;
            /* 內邊距設定為 2px */
            border: 0.5px solid var(--textarea-border);
            /* 使用 CSS 變數 */
            border-radius: 4px;
            /* 邊框圓角設定為 4px */
            background-color: var(--textarea-background);
            /* 使用 CSS 變數 */
            color: var(--text-color);
            /* 使用 CSS 變數 */
            font-size: 24px;
            /* 字體大小設定為 24px */
            line-height: 1.4;
            /* 行高設定為 1.4 倍 */
            white-space: pre-wrap;
            /* 保留空白字符和換行 */
            word-wrap: break-word;
            /* 自動換行 */
            margin-bottom: 0;
            /* 移除舊的底部邊距 */
            box-shadow: inset 0 0.5px 1.5px rgba(0, 0, 0, 0.03);
            /* 內陰影效果 */
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
            /* 主題切換過渡效果 */
        }

        .char-select {
        /* 一對多待選字 */
            font-size: 24px;
            /* 字體大小設定為 24px */
            /* 調整邊框厚度 */
            border: 0.2px solid var(--select-border);
            /* 使用 CSS 變數 */
            border-radius: 2px;
            /* 邊框圓角減半為 2px */
            background-color: transparent;
            /* 背景色設定為透明 */
            font-family: inherit;
            /* 繼承字體族 */
            width: 1.2em;
            /* 預設寬度為 1.2em */
            padding: 1px 0px 0px 1px;
            /* 內邊距設定為上1px，右0px，下0px，左1px */
            margin: 0 1px;
            /* 外邊距設定為垂直0，水平1px */
            vertical-align: middle;
            /* 垂直對齊方式為中間 */
            transition: all 0.3s;
            /* 所有屬性 0.3 秒過渡效果 */
            color: var(--select-color);
            /* 使用 CSS 變數 */
            cursor: pointer;
            /* 滑鼠游標設定為指標樣式 */
            -webkit-appearance: none;
            /* 移除 WebKit 預設外觀 */
            appearance: none;
            /* 移除預設外觀 */
            /* 一對多待選字下拉選單向下箭頭的內嵌 SVG 圖示，無需 Font Awesome */
            background-image: var(--select-arrow-svg, url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' fill='%23dc3545' viewBox='0 0 16 16'%3E%3Cpath d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E"));
            background-repeat: no-repeat;
            /* 背景圖片不重複 */
            background-position: right 2px center;
            /* 背景圖片位置調整 */
            background-size: 4px 4px;
            /* 背景圖片大小減小 */
            display: inline-block;
            /* 行內塊元素 */
            text-align: left;
            /* 文字左對齊 */
            text-overflow: clip;
            /* 文字溢出時裁剪 */
            white-space: nowrap;
            /* 不換行 */
            overflow: hidden;
            /* 隱藏溢出內容 */
            /* 向上移動 0.1 倍行高 */
            transform: translateY(-0.1em);
            /* 向上移動 0.1 倍自身字體大小 */
            /* 移除此處的 position 和 z-index，僅用於聚焦狀態 */
        }

        body.dark-theme .char-select {
        /* 暗黑主題：一對多待選字下拉選單向下箭頭的內嵌 SVG 圖示，無需 Font Awesome。是否多餘？ */
            --select-arrow-svg: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' fill='%23f87171' viewBox='0 0 16 16'%3E%3Cpath d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
        }

        .char-select.is-focused {
        /* 一對多待選字聚焦狀態的改變 */
            outline: none;
            /* 移除瀏覽器默認的聚焦外框 */
            border-color: var(--select-focus-border);
            /* 改變邊框顏色 */
            box-shadow: 0 0 0 1px var(--select-focus-shadow);
            /* 添加聚焦邊框效果 */
            background-color: var(--panel-background);
            /* 改變背景色 */
            z-index: 1000;
            /* 設定堆疊順序，提升層級確保在最上層 */
}

        /* 固定選擇 */
        .fixed-choice {
            color: var(--fixed-choice-color);
            /* 使用 CSS 變數 */
        }

        /* 右面板（最終結果）樣式 */
        #final-result {
            min-height: 150px;
            /* 減少高度 */
            resize: vertical;
            /* 允許垂直調整大小 */
            border: 0.5px solid var(--textarea-border);
            /* 更改為與其他文本區域相同的實線淺灰色邊框 */
            font-size: 16px;
            /* 減少字體大小 */
            padding: 4px;
            /* 減少內邊距 */
            box-shadow: inset 0 0.5px 1.5px rgba(0, 0, 0, 0.03);
            /* 減少陰影 */
            flex-grow: 1;
            /* 允許最終結果區域填充容器中的可用空間 */
            overflow: auto;
            /* 確保文字區域本身可以滾動 */
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
            /* 主題切換過渡效果 */
        }

        /* 複製按鈕容器樣式 */
        .copy-button-container {
            position: relative;
            /* 使內部複製按鈕相對定位 */
            margin-bottom: 2px;
            /* 已修改為 3px */
            display: flex;
            /* 使其成為 flex 容器以對齊標籤和按鈕 */
            justify-content: space-between;
            /* 標籤和按鈕之間的間距 */
            align-items: center;
            /* 垂直居中對齊 */
            flex-shrink: 0;
            /* 防止複製按鈕容器在空間有限時縮小 */
        }

        .copy-message {
            position: absolute;
            /* 絕對定位 */
            top: 50%;
            /* 距離頂部 50% */
            left: 50%;
            /* 距離左側 50% */
            transform: translate(-50%, -50%);
            /* 居中顯示 */
            background-color: var(--copy-message-background);
            /* 使用 CSS 變數 */
            color: var(--copy-message-color);
            /* 使用 CSS 變數 */
            padding: 2px 2px;
            /* 減少內邊距 */
            border-radius: 3px;
            /* 邊框圓角減半 */
            font-size: 16px;
            /* 減少字體大小 */
            opacity: 0;
            /* 初始透明度為 0 (隱藏) */
            transition: opacity 0.3s ease-in-out, background-color 0.3s ease, color 0.3s ease;
            /* 透明度過渡效果和主題切換過渡效果 */
            pointer-events: none;
            /* 確保不會阻擋滑鼠事件 */
        }

        .copy-message.show {
            opacity: 1;
            /* 顯示時透明度為 1 */
        }

        /* 字義辨析面板樣式（現在在左面板內） */
        .disambiguation-panel {
            flex-grow: 1;
            /* 允許填充可用空間 */
            overflow-y: auto;
            /* 為其內容添加垂直滾動條 */
            background: var(--panel-background);
            /* 使用 CSS 變數 */
            padding: 6px;
            /* 減少面板內邊距 */
            border-radius: 4px;
            /* 邊框圓角減半 */
            border: 0.5px solid var(--textarea-border);
            /* 更改為與其他文本區域相同的實線淺灰色邊框 */
            min-height: 0;
            /* 允許 flex 項目在需要時縮小到小於其內容大小 */
            transition: background 0.3s ease, border-color 0.3s ease;
            /* 主題切換過渡效果 */
        }

        .disambiguation-content {
            font-size: 24px;
            /* 根據要求增加字體大小 */
            line-height: 1.4;
            /* 減少行高以縮小間距 */
            word-wrap: break-word;
            /* 自動換行 */
        }

        .disambiguation-content h3 {
            margin-top: 1em;
            margin-bottom: 1em;
            font-size: 1.0em;
        }

        /* 修改這裡：為 disambiguation-content 內的段落增加間距 */
        .disambiguation-content p {
            margin-top: 1em;
            margin-bottom: 1em;
        }

        /* 修改這裡：為例詞部分增加頂部間距 */
        .disambiguation-content .examples {
            font-size: 1.0em;
            margin-top: 1em;
            margin-bottom: 1em;
        }

    </style>
</head>

<body>
    <div class="theme-toggle-container">
        <button id="theme-toggle-btn" class="theme-toggle-btn">
            <span class="sun-icon">☀️</span>
            <span class="moon-icon">☽</span>
        </button>
    </div>

    <div class="github-button-container">
        <a href="https://github.com/yshumy/jian-fan" target="_blank" class="github-btn">
            Github
        </a>
    </div>

    <div class="overall-wrapper">
        <header>
            <h1>半自動簡繁轉換 - 自主選擇一對多</h1>
        </header>

        <div class="main-content-grid">
            <!-- 左面板：分為兩個部分 -->
            <div class="left-panel">
                <!-- 左上部分：輸入文字區域 -->
                <div class="left-top-section">
                    <div class="input-area">
                        <div class="input-area-header">
                            <label for="source-text">輸入文字：</label>
                            <!-- 已更新：添加 action-btn 類別 -->
                            <button id="clear-source-text-btn" class="action-btn clear-button">清空</button>
                        </div>
                        <textarea id="source-text"
                            placeholder="在此輸入中文文本...">測試文本：宫宮家傢宽寬宾賓寝寢对對寻尋导導寿壽干幹乾并並併离離私俬秃禿秆稈秋鞦种種;constradTSimD亂乱亙亘亞亚佇伫佈布佔占來来侖仑侶侣侷局俁俣係系俓𠇹俔伣俠侠俥伡倀伥倆俩倈俫倉仓個个們们倖幸倫伦倲㑈偉伟偑㐽側侧偵侦偽伪傌㐷傑杰傖伧傘伞備备把第貳組字貼到這裡CJK擴展C區測試：㓆𠗣㛟𡞵㛠𡢃㟜𡾱㛿𡠹㭣𣙎㳢𣾷㻏𤫩㻘𤪺䑽𦪙䘛𧝞䘞𧜗䙊𧜵䜥𧩙䜧𧪄䞌𧵳䞍䝼䞎𧶧䢀𨊰䢁𨊸䢂𨋢䥿𨯅䦀𨦫䦁𨧜䭪𩞯䯃𩣑䲞𩶘凙𪞝僤𫢸儣𠆲儭𠋆俓𠇹剾𠛅。</textarea>
                    </div>
                    <div class="controls">
                        <button id="btn-to-trad" class="btn btn-to-trad">—— 簡 轉 繁 ——</button>
                        <button id="btn-to-sim" class="btn btn-to-sim">—— 繁 轉 簡 ——</button>
                    </div>
                    
                    <!-- 異體字排除控制 -->
                    <div class="variant-exclusion-container">
                        <label class="variant-exclusion-label">
                            <input type="checkbox" id="exclude-variants-checkbox" class="variant-exclusion-checkbox">
                            異體字不參與轉換
                        </label>
                    </div>
                </div>

                <!-- 字義辨析面板（移至左面板內） -->
                <div class="disambiguation-panel">
                    <div class="result-header">
                        <label>簡繁一對多字義辨析：</label>
                    </div>
                    <div id="disambiguation-note" class="disambiguation-content">
                        <h3>請點擊互動區中的紅色下拉選單，此處將顯示該字的簡繁一對多字義辨析。</h3>
                    </div>
                </div>

                <!-- 左下部分：功能說明和提示 -->
                <div class="feature-points">
                    <div class="feature">
                        <h4>【選擇固定】</h4>
                        <p>已選定的轉換結果以<span style="color: var(--fixed-choice-color); ">綠字</span>顯示，不受後續全局轉換影響。</p>
                    </div>
                    <div class="feature">
                        <h4>【鄰字感知】</h4>
                        <p>當前字的相鄰字被修改後，自動更新下拉選單的備選項。</p>
                    </div>
                </div>
            </div>

            <!-- 中間面板：互動結果 -->
            <div class="middle-panel">
                <div class="result-container">
                    <div class="result-header">
                        <label>一對多自主選擇：</label>
                        <!-- 已更新：添加撤銷/重做按鈕 -->
                        <div style="display: flex; gap: 4px;">
                            <button id="undo-btn" class="action-btn undo-btn" disabled>撤銷</button>
                            <button id="redo-btn" class="action-btn redo-btn" disabled>重做</button>
                            <button id="reset-btn" class="action-btn reset-btn">重置</button>
                        </div>
                    </div>
                    <div id="interactive-result"></div>
                </div>
            </div>

            <!-- 右面板：最終結果 -->
            <div class="right-panel">
                <div class="result-container">
                    <!-- 複製按鈕容器，用於定位複製按鈕 -->
                    <div class="copy-button-container">
                        <label for="final-result">最終結果：</label>
                        <!-- 已更新：添加 action-btn 類別 -->
                        <button id="copy-final-result-btn" class="action-btn copy-button" title="複製最終結果">複製</button>
                        <span id="copy-message" class="copy-message">已複製!</span>
                    </div>
                    <textarea id="final-result" readonly placeholder="轉換結果將顯示在此..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 引入字義辨析數據
        // 這個陣列包含了簡體字、對應的繁體字選項、字義辨析和例詞。
        // 當用戶在互動區選擇某個字的下拉選單時，可以根據此數據顯示註釋。
        const characterDisambiguationData = [
            {
                simplified: '划',
                traditionalOptions: ['劃', '畫', '划'],
                disambiguation: '「划」讀音hua2，意義為「撥水前進」、「合算」。\n「劃」讀作hua2時，意義為「戳傷」，讀作hua4是意義為「分界」、「設計」。\n「畫」基本意義為「繪畫」。',
                examples: '劃分、劃破、圖畫、畫押、划船、划算。'
            },
            {
                simplified: '卤',
                traditionalOptions: ['滷', '鹵'],
                disambiguation: '「滷」特別作為一種烹調方法，「鹵」用作其他意義或化學元素。',
                examples: '滷汁、滷肉、鹵素。'
            },
            {
                simplified: '歷',
                traditionalOptions: ['歷', '曆'],
                disambiguation: '「日曆」作「曆」，與歷史有關用「歷」。',
                examples: '萬年曆、歷史。'
            },
            {
                simplified: '发',
                traditionalOptions: ['發', '髮'],
                disambiguation: '與毛髮有關用「髮」，其餘意義為「發」。',
                examples: '發財、發送、頭髮、令人髮指。'
            },
            {
                simplified: '只',
                traditionalOptions: ['只', '隻'],
                disambiguation: '「隻」用作量詞，「只」為副詞「僅」。',
                examples: '船隻、隻言片語、只有、僅只。'
            },
            {
                simplified: '台',
                traditionalOptions: ['臺', '檯', '颱', '台'],
                disambiguation: '與「平地」有關用「臺」，與「櫃檯」有關用「檯」，與「颱風」有關用「颱」。\n「台」為罕用字。',
                examples: '看臺、高臺、電視臺、寫字檯、颱風、兄台、天台山、五臺山、臺灣。'
            },
            {
                simplified: '后',
                traditionalOptions: ['後', '后'],
                disambiguation: '與「帝王」、「帝王配偶」有關用「后」，與「時間先後」有關用「後」。',
                examples: '皇后、以後。'
            },
            {
                simplified: '坛',
                traditionalOptions: ['壇', '罈'],
                disambiguation: '「罈」為一種容器，其餘意義為「壇」。',
                examples: '祭壇、論壇、罈子、酒罈。'
            },
            {
                simplified: '复',
                traditionalOptions: ['復', '複', '覆'],
                disambiguation: '表示重疊意義用「複」，表示往返意義用「復」，表示「翻倒」、「遮蓋」用「覆」。',
                examples: '複製、重複、反復、恢復、覆蓋、傾覆、翻雲覆雨、反覆無常。'
            },
            {
                simplified: '盡',
                traditionalOptions: ['盡', '儘'],
                disambiguation: '「儘」用於「放開」、「最大限度」之意。其餘用「盡」。',
                examples: '儘管、儘量、極盡、自盡、盡頭。'
            },
            {
                simplified: '干',
                traditionalOptions: ['幹', '乾', '干', '榦'],
                disambiguation: '「干」本意為盾牌，意義與武器有關。\n「乾」意義為「水分少」。\n「幹」意義為「主幹」或為動詞。\n「榦」特別用於「版榦」。',
                examples: '干戈、干涉、干擾、干預、乾燥、乾貨、骨幹、幹部、幹活、版榦。'
            },
            {
                simplified: '并',
                traditionalOptions: ['並', '併', '并'],
                disambiguation: '「併」特比用於「合併」之義，其餘一般作「並」。',
                examples: '並且、兼併、吞併、并州、兼容并包。'
            },
            {
                simplified: '当',
                traditionalOptions: ['當', '噹'],
                disambiguation: '「噹」用於擬聲詞，其餘用「當」。',
                examples: '叮噹、噹啷、當然、當年、應當。'
            },
            {
                simplified: '志',
                traditionalOptions: ['志', '誌'],
                disambiguation: '與記錄有關用「誌」，其餘用「志」。',
                examples: '志向、志氣、雜誌、日誌。'
            },
            {
                simplified: '匯',
                traditionalOptions: ['匯', '彙'],
                disambiguation: '「彙」為「相同種類聚集成的東西」，「匯」傾向於「水流匯合」一動作。',
                examples: '辭彙、彙編、彙報、匯合、匯款。'
            },
            {
                simplified: '系',
                traditionalOptions: ['係', '系', '繫'],
                disambiguation: '字理上：「係」強調「關係」，「系」為一個整體，「繫」與連接有關。',
                examples: '系統、係數、干係、關係、聯繫、維繫、繫鞋帶。'
            },
            {
                simplified: '脏',
                traditionalOptions: ['髒', '臟'],
                disambiguation: '「臟」讀音zang4，意義為「身體器官」，「髒」讀音zang1，意義為「不乾淨」。',
                examples: '內臟、骯髒。'
            },
            {
                simplified: '荡',
                traditionalOptions: ['蕩', '盪'],
                disambiguation: '與「洗滌」、「搖動」有掛用「盪」，其餘用「蕩」。',
                examples: '盪漾、盪滌、動盪、掃蕩、放蕩、蕩然無存、蕩氣迴腸。'
            },
            {
                simplified: '獲',
                traditionalOptions: ['獲', '穫'],
                disambiguation: '「獲」一般用於動詞，「穫」一般用於名詞。',
                examples: '不勞而獲、獲益、收穫。'
            },
            {
                simplified: '采',
                traditionalOptions: ['採', '采'],
                disambiguation: '「採」用於動詞，其餘用「采」。',
                examples: '採集、博採眾長、丰采、神采奕奕。'
            },
            {
                simplified: '里',
                traditionalOptions: ['里', '裏'],
                disambiguation: '「裏」與「外」相對，其餘用「里」。',
                examples: '里程、故里、裏外。'
            },
            {
                simplified: '鐘',
                traditionalOptions: ['鍾', '鐘'],
                disambiguation: '「鍾」意義為聚集，「鐘」為一種樂器。',
                examples: '鍾情、鍾愛、鐘鼓、掩耳盜鐘。'
            },
            {
                simplified: '饥',
                traditionalOptions: ['飢', '饑'],
                disambiguation: '「飢」意義為「吃不飽」，「饑」意義為「穀物不熟」。',
                examples: '飢餓、饑荒、饑饉。'
            },
            {
                simplified: '丰',
                traditionalOptions: ['豐', '丰'],
                disambiguation: '表示「美好的容貌的姿態」用「丰」，其餘一般為「豐」。',
                examples: '丰采、丰姿、豐富、五穀豐登、張三丰。'
            },
            {
                simplified: '丑',
                traditionalOptions: ['醜', '丑'],
                disambiguation: '「丑」用於十二地支和戲角色，「醜」為「不美」。',
                examples: '小丑、丑角、辛丑條約、醜陋、醜惡。'
            },
            {
                simplified: '了',
                traditionalOptions: ['了', '瞭'],
                disambiguation: '「了」意義為「完畢」、「完全」。\n「瞭」讀作liao3時意義為「明白」、「清楚」，讀作liao4時意義為「遠看」。',
                examples: '不了了之、了無牽掛、明瞭、瞭解、一目瞭然、瞭望。'
            },
            {
                simplified: '借',
                traditionalOptions: ['借', '藉'],
                disambiguation: '「依賴、假借、草墊」之意用「藉」，其餘一般用「借」。（習慣用法區別）',
                examples: '慰藉、藉口、憑藉、借住、借題發揮、借刀殺人。'
            },
            {
                simplified: '克',
                traditionalOptions: ['克', '剋'],
                disambiguation: '與「戰勝」、「約束」、「傷害」有關意義用「剋」，其餘用「克」。',
                examples: '克服、以柔克剛、千克、攻剋、剋扣、剋夫。'
            },
            {
                simplified: '准',
                traditionalOptions: ['準', '准'],
                disambiguation: '「准」只用於「允許」意義，其餘用「準」。',
                examples: '准許、不准、準備、標準。'
            },
            {
                simplified: '刮',
                traditionalOptions: ['刮', '颳'],
                disambiguation: '「吹襲」用「颳」，其餘用「刮」。',
                examples: '颳風、冰前颳雪、刮鬍子、刮痧、耳刮子。'
            },
            {
                simplified: '制',
                traditionalOptions: ['制', '製'],
                disambiguation: '「製」只用於「製作」相關意義，其餘用「制」。',
                examples: '制度、控制、製作。'
            },
            {
                simplified: '吁',
                traditionalOptions: ['籲', '吁'],
                disambiguation: '「呼喊﹑請求」用「籲」，讀音yu4，「歎氣」用「吁」，讀音xu1。',
                examples: '長吁短歎、呼籲、籲請。'
            },
            {
                simplified: '吊',
                traditionalOptions: ['吊', '弔'],
                disambiguation: '「弔」只用於「祭奠死者」相關意義，其餘用「吊」。',
                examples: '吊車、上吊、弔唁、弔喪。'
            },
            {
                simplified: '团',
                traditionalOptions: ['團', '糰'],
                disambiguation: '與「食品」有關用「糰」，其餘用團。',
                examples: '飯糰、糯米糰、團體、社團。'
            },
            {
                simplified: '困',
                traditionalOptions: ['困', '睏'],
                disambiguation: '「睏」特指「瞌睡」，其餘用「困」。',
                examples: '困擾、困局、貧困、睏意、睏倦。'
            },
            {
                simplified: '布',
                traditionalOptions: ['佈', '布'],
                disambiguation: '「布」為「紡織品」，其餘用「佈」。',
                examples: '棉布、發佈、佈置、擺佈、遍佈。'
            },
            {
                simplified: '御',
                traditionalOptions: ['御', '禦'],
                disambiguation: '與「抵抗」有關用「禦」，其餘用「御」。',
                examples: '御馬、御用、防禦、抵禦。'
            },
            {
                simplified: '斗',
                traditionalOptions: ['鬭', '斗'],
                disambiguation: '「斗」為一種容積計量單位，「鬭」表示「鬭爭」之意。',
                examples: '五斗米、車載斗量、鬭爭、戰鬭。'
            },
            {
                simplified: '曲',
                traditionalOptions: ['曲', '麯'],
                disambiguation: '「麯」與釀酒有關，其餘用「曲」。',
                examples: '樂曲、曲直、酒麯、大麯。'
            },
            {
                simplified: '松',
                traditionalOptions: ['鬆', '松'],
                disambiguation: '「松」為一種樹木名詞，「鬆」與「緊」相對。',
                examples: '松樹、雪松、輕鬆、肉鬆。'
            },
            {
                simplified: '淀',
                traditionalOptions: ['澱', '淀'],
                disambiguation: '「淀」之意義為「淺水」，其餘用「澱」。',
                examples: '澱粉、沉澱、海淀區、白洋淀。'
            },
            {
                simplified: '纤',
                traditionalOptions: ['纖', '縴'],
                disambiguation: '表示「細小」用「纖」，讀作xian1。\n表示拉船用「縴」，讀作qian4。',
                examples: '纖維、光纖、縴夫。'
            },
            {
                simplified: '致',
                traditionalOptions: ['致', '緻'],
                disambiguation: '與「細密」、「意趣」有關用「緻」，其餘用致。',
                examples: '導致、致敬、精緻、緻密、別緻、雅緻。'
            },
            {
                simplified: '蔑',
                traditionalOptions: ['蔑', '衊'],
                disambiguation: '表示「血污」、「誹謗」用「衊」，其餘意義用「蔑」。',
                examples: '輕蔑、蔑視、誣衊。'
            },
            {
                simplified: '仇',
                traditionalOptions: ['仇', '讎'],
                disambiguation: '與「校對」有關用「讎」，其餘用「仇」。',
                examples: '仇恨、報仇、讎校、仇讎。'
            },
            {
                simplified: '冬',
                traditionalOptions: ['冬', '鼕'],
                disambiguation: '「鼕」為鼓聲擬聲詞，其餘用「冬」。',
                examples: '隆冬、冬暖夏涼、鼕鼕。'
            },
            {
                simplified: '咸',
                traditionalOptions: ['咸', '鹹'],
                disambiguation: '「鹹」意義與「淡」相對，其餘用「咸」。',
                examples: '老少咸宜、鹹淡。'
            },
            {
                simplified: '云',
                traditionalOptions: ['雲', '云'],
                disambiguation: '「云」意義為「說」，其餘用「雲」。',
                examples: '人云亦云、雲霧。'
            },
            {
                simplified: '仆',
                traditionalOptions: ['僕', '仆'],
                disambiguation: '「仆」意義為「跌倒」，讀音pu1。\n「僕」為「供人使喚的人」，讀音pu2。',
                examples: '前仆後繼、仆街、奴僕、公僕、風塵僕僕。'
            },
            {
                simplified: '舍',
                traditionalOptions: ['舍', '捨'],
                disambiguation: '「捨」讀作she3，用於「放棄」意義，其餘用「舍」，讀作she4，古文亦同「捨」。',
                examples: '宿舍、村舍、退避三舍、捨弃、舍我其誰、不舍晝夜。'
            },
            {
                simplified: '簽',
                traditionalOptions: ['籖', '簽'],
                disambiguation: '「簽」用於動詞，表示「題字題名」，其餘用「籤」。',
                examples: '簽名、簽證、標籤、書籤、牙籤。'
            },
            {
                simplified: '折',
                traditionalOptions: ['折', '摺'],
                disambiguation: '與「疊」有關用「摺」，與「斷」有關用「折」。',
                examples: '摺紙、摺扇、存摺、折斷、折腰、折服、打折、損兵折將。'
            },
            {
                simplified: '谷',
                traditionalOptions: ['谷', '穀'],
                disambiguation: '表示「兩山之間」的地域用「谷」，表示農作物時用「穀」。',
                examples: '山谷、稻穀。'
            },
            {
                simplified: '几',
                traditionalOptions: ['幾', '几'],
                disambiguation: '「几」只用作「茶几」。表示「幾乎」、「幾個」意義用「幾」。',
                examples: '茶几、幾乎、幾個。'
            },
            {
                simplified: '辟',
                traditionalOptions: ['闢', '辟'],
                disambiguation: '「闢」用於「開墾」、「駁斥」意義。其餘用「辟」。',
                examples: '開闢、闢謠、另闢蹊徑、精闢、辟邪、鞭辟入裏。'
            },
            {
                simplified: '奸',
                traditionalOptions: ['奸', '姦'],
                disambiguation: '「姦」只用於淫亂之意，其餘用「奸」。',
                examples: '漢奸、狼狽為奸、強姦。'
            },
            {
                simplified: '游',
                traditionalOptions: ['遊', '游'],
                disambiguation: '「游」與「水」有關，其餘用「遊」。',
                examples: '游泳、上游、遊戲、遊蕩。'
            },
            {
                simplified: '佣',
                traditionalOptions: ['傭', '佣'],
                disambiguation: '「傭」為「僕役」，讀音yong1。\n「佣」為「中間人」，讀音yong4。',
                examples: '傭人、雇傭、傭兵、佣金。'
            },
            {
                simplified: '苏',
                traditionalOptions: ['蘇', '囌', '甦'],
                disambiguation: '「甦」與「醒」、「恢復」有關，「囌」用於「嚕囌」（囉唆），其餘用「蘇」。',
                examples: '甦醒、甦生、復甦、嚕囌、蘇州、屠蘇、蘇俄。'
            },
            {
                simplified: '回',
                traditionalOptions: ['回', '迴'],
                disambiguation: '與「旋轉」、「返回」有關用「迴」，其餘用「回」。',
                examples: '迴合、迴光返照、迴旋、迴避、回答、回族、回絕。'
            },
            {
                simplified: '面',
                traditionalOptions: ['面', '麪'],
                disambiguation: '「面」意義為「臉」、「外表」，「麪」為小麥磨成的粉。',
                examples: '臉面、麪條、麪粉。'
            },
            {
                simplified: '向',
                traditionalOptions: ['向', '嚮', '曏'],
                disambiguation: '「曏」表示「從前」，「嚮」表示「引導」、「傾向」，其餘用「向」。',
                examples: '曏者、嚮導、嚮往、嚮晦、方向、意向、向晚、向背、向來。'
            },
            {
                simplified: '伙',
                traditionalOptions: ['夥', '伙'],
                disambiguation: '「伙」只用於「伙食」、「工具」相關意義，其餘用「夥」。',
                examples: '夥同、夥伴、小夥子、伙食、包伙、傢伙。'
            },
            {
                simplified: '郁',
                traditionalOptions: ['鬱', '郁'],
                disambiguation: '與「文采豐盛」、「濃烈」有關意義用「郁」，其餘用「鬱」。',
                examples: '馥郁、郁郁乎文哉、鬱結、憂鬱、鬱金香、鬱悶、鬱郁。'
            },
            {
                simplified: '朴',
                traditionalOptions: ['樸', '朴'],
                disambiguation: '表示「原本的」意義用「樸」，其他音義用「朴」。',
                examples: '樸素、純樸、質樸、朴刀、朴姓、朴硝。'
            },
            {
                simplified: '才',
                traditionalOptions: ['才', '纔'],
                disambiguation: '表示「方」、「僅」用「纔」，其餘用「才」。',
                examples: '才俊、才幹、才能、纔能、剛纔、方纔。'
            },
            {
                simplified: '朱',
                traditionalOptions: ['朱', '硃'],
                disambiguation: '「硃」用於與「硃砂」有關意義，其餘用「朱」。',
                examples: '硃砂、近朱者赤。'
            },
            {
                simplified: '别',
                traditionalOptions: ['別', '彆'],
                disambiguation: '「彆」讀音bie4，與「彆扭」有關，其餘用「別」。',
                examples: '區別、彆扭。'
            },
            {
                simplified: '卷',
                traditionalOptions: ['捲', '卷'],
                disambiguation: '「捲」表示彎曲，讀音juan3，其餘用「卷」，讀音juan4。',
                examples: '席捲、捲土重來、花捲、試卷、卷帙、讀萬卷書。'
            },
            {
                simplified: '蒙',
                traditionalOptions: ['蒙', '矇', '濛', '懞'],
                disambiguation: '表示「欺騙」、「猜測」、「盲」用「矇」，表示「細雨」用「濛」，表示「老實」用「「懞」，其餘意義用「蒙」。',
                examples: '矇騙、矇蔽、矇混、濛濛細雨、涳濛、懞直、蒙受、蒙昧、啓蒙、蒙古。'
            },
            {
                simplified: '征',
                traditionalOptions: ['徵', '征'],
                disambiguation: '與「召集」和「蹟象」有關用「徵」，與「遠征」、「討伐」有關用「征」。',
                examples: '征服、遠征、徵兵、徵收、徵兆、特徵、徵詢。'
            },
            {
                simplified: '症',
                traditionalOptions: ['症', '癥'],
                disambiguation: '「癥」為一種「腹中結硬塊的疾病」，讀音zheng1。\n一般病症用「症」，讀音zheng4。',
                examples: '絕症、癌症、對症下藥、癥結。'
            },
            {
                simplified: '恶',
                traditionalOptions: ['惡', '噁'],
                disambiguation: '「噁心」用「噁」，其餘一般用「惡」。',
                examples: '善惡、噁心、二噁英。'
            },
            {
                simplified: '注',
                traditionalOptions: ['注', '註'],
                disambiguation: '與「記錄」有關意義用「註」，其餘用「注」。',
                examples: '注意、注入、關注、註冊、註釋、命中註定。'
            },
            {
                simplified: '哄',
                traditionalOptions: ['哄', '鬨'],
                disambiguation: '與「眾人喧鬧」有關用「鬨」，讀音hong4，其餘用「哄」。',
                examples: '哄騙、哄孩子、起鬨、一鬨而散。'
            },
            {
                simplified: '参',
                traditionalOptions: ['參', '蔘'],
                disambiguation: '「蔘」表示一種植物，其餘用「參」。',
                examples: '參與、參數、內参、海参崴、人蔘、黃金蔘。'
            },
            {
                simplified: '腌',
                traditionalOptions: ['醃', '腌'],
                disambiguation: '「腌」用於「腌臢」，表示一種食物加工方法用「醃」。',
                examples: '腌臢、醃漬、醃肉。'
            },
            {
                simplified: '彩',
                traditionalOptions: ['彩', '綵'],
                disambiguation: '表示「五彩的絲織品」用「綵」，其餘用「彩」。',
                examples: '張燈結綵、綵頭、剪綵、彩票、五彩繽紛。'
            },
            {
                simplified: '占',
                traditionalOptions: ['佔', '占'],
                disambiguation: '與巫術有關用「占」，讀音zhan1，其餘用「佔」，讀音zhan4。',
                examples: '占卜、占星、佔領、佔據。'
            },
            {
                simplified: '欲',
                traditionalOptions: ['欲', '慾'],
                disambiguation: '「慾」只用於「情慾」有關意義，其餘用「欲」。',
                examples: '獸慾、慾火、貪欲、暢所欲言、震耳欲聾。'
            },
            {
                simplified: '扎',
                traditionalOptions: ['扎', '紮'],
                disambiguation: '表示「纏束」、「軍隊屯駐」用「紮」，其餘用「扎」。',
                examples: '駐紮、包紮、安營紮寨、扎針、扎花、掙扎。'
            },
            {
                simplified: '熏',
                traditionalOptions: ['熏', '燻'],
                disambiguation: '「燻」特指一種烹飪方法，其餘用「熏」。',
                examples: '熏陶、利慾熏心、臭氣熏天、燻肉。'
            },
            {
                simplified: '贊',
                traditionalOptions: ['贊', '讚'],
                disambiguation: '與「表揚」有關意義用「讚」，其餘用「贊」。',
                examples: '贊助、贊同、讚美。'
            },
            {
                simplified: '嘗',
                traditionalOptions: ['嘗', '嚐'],
                disambiguation: '與「吃」、「品嚐」有關意義用「嚐」，其餘用「嘗」。',
                examples: '嘗試、品嚐。'
            },
            {
                simplified: '烟',
                traditionalOptions: ['煙', '菸'],
                disambiguation: '「煙」用於一般煙霧，與「菸草」有關時用「菸」。',
                examples: '煙霧、菸草、香菸。'
            },
            {
                simplified: '周',
                traditionalOptions: ['周', '週', '賙'],
                disambiguation: '與「週期」有關用「週」，濟助他人用「賙」，其餘意義為「周」。',
                examples: '周朝、眾所周知、週歲、週而復始、賙濟。'
            },
            {
                simplified: '柜',
                traditionalOptions: ['櫃', '柜'],
                disambiguation: '表示收藏東西的傢具時作「櫃」，表示一種落葉喬木用「柜」。',
                examples: '書櫃、柜柳。'
            },
            {
                simplified: '喂',
                traditionalOptions: ['餵', '喂'],
                disambiguation: '表示「餵養」時用「餵」，「喂」僅用作語氣詞。',
                examples: '餵豬、喂！'
            },
            {
                simplified: '幸',
                traditionalOptions: ['幸', '倖'],
                disambiguation: '「倖」專指「意外地成功或避免」，其餘一般用「幸」。',
                examples: '倖免、倖存、僥倖、倖運、幸福、寵幸、慶幸。'
            },
            {
                simplified: '凶',
                traditionalOptions: ['兇', '凶'],
                disambiguation: '與占卜吉凶有關用「凶」，與「殺害」有關用「兇」。',
                examples: '凶宅、吉凶、兇殺、兇器、行兇。'
            },
            {
                simplified: '杰',
                traditionalOptions: ['傑', '杰'],
                disambiguation: '「杰」常用於人名，表示「出眾」用「傑」。',
                examples: '傑出、俊傑、傑作、李連杰、周杰倫、狄仁杰。'
            },
            {
                simplified: '針',
                traditionalOptions: ['針', '鍼'],
                disambiguation: '「鍼」用於以砭石製成的針，其餘均作「針」。',
                examples: '針線、針鋒相對、鍼砭、鍼灸。'
            },
            {
                simplified: '戚',
                traditionalOptions: ['戚', '慼', '鏚'],
                disambiguation: '表示「憂愁」、「悲傷」用「慼」，「鏚」為一種武器，其他意義用「戚」。',
                examples: '悲慼、慼慼、干鏚羽旄、戚繼光、親戚。'
            },
            {
                simplified: '托',
                traditionalOptions: ['托', '託'],
                disambiguation: '與「捧呈」、「承受」有關用「托」，與「寄」、「委任」有關用「託」。',
                examples: '襯托、槍托、寄託、託付、推託。'
            },
            {
                simplified: '挨',
                traditionalOptions: ['挨', '捱'],
                disambiguation: '表示「承受」、「拖延」、「抗拒」有關用「捱」，讀為ai2，其餘用「挨」，讀為ai1。',
                examples: '挨家挨戶、捱打。'
            },
            {
                simplified: '挽',
                traditionalOptions: ['挽', '輓'],
                disambiguation: '與「哀悼死者」有關用「輓」，其餘意義為「挽」。',
                examples: '挽救、力挽狂瀾、輓聯、哀輓。'
            },
            {
                simplified: '栗',
                traditionalOptions: ['慄', '栗'],
                disambiguation: '表示「因恐懼而發抖」用「慄」，其餘意義用「栗」。',
                examples: '板栗、火中取栗、戰慄、不寒而慄。'
            },
            {
                simplified: '煉',
                traditionalOptions: ['煉', '鍊'],
                disambiguation: '專指「熔鍊金屬」時用「鍊」，一般意義用「煉」。',
                examples: '鍊鐵、淬鍊、煉乳、修煉。'
            },
            {
                simplified: '鏈',
                traditionalOptions: ['鏈', '鍊'],
                disambiguation: '「鏈」用作一般的「金屬繩狀物」，「鍊」專指首飾。',
                examples: '鎖鏈、鏈接、項鍊、金手鍊。'
            },
            {
                simplified: '穗',
                traditionalOptions: ['穗', '繐'],
                disambiguation: '「繐」用作「結紮成的裝飾物」，其餘用「穗」。',
                examples: '麥穗、帽繐。'
            },
            {
                simplified: '雕',
                traditionalOptions: ['雕', '鵰'],
                disambiguation: '「鵰」為一種猛禽，與「雕刻」有關時用「雕」。',
                examples: '一箭雙鵰、雕刻、雕蟲小技。'
            },
            {
                simplified: '梁',
                traditionalOptions: ['樑', '梁'],
                disambiguation: '與「橋樑」、「棟樑」有關用「樑」，其餘意義為「梁」。',
                examples: '樑上君子、鼻樑、大梁城、梁朝、梁山。'
            },
            {
                simplified: '升',
                traditionalOptions: ['升', '昇'],
                disambiguation: '「昇」字帶有濃烈喜慶氣氛，其餘用「升」。',
                examples: '上升、一升水、旭日東昇、歌舞昇平。'
            },
            {
                simplified: '擺',
                traditionalOptions: ['擺', '襬'],
                disambiguation: '表示「衣服下緣的部分」用「襬」，其餘用「擺」。',
                examples: '搖擺、擺放、裙襬、下襬。'
            },
            {
                simplified: '岩',
                traditionalOptions: ['巖', '岩'],
                disambiguation: '「岩」只用於「岩石」相關意義，其餘用「巖」。',
                examples: '沉積岩、岩漿、巖壁、中空成巖。'
            },
            {
                simplified: '娘',
                traditionalOptions: ['娘', '孃'],
                disambiguation: '「孃」意義為「母親」，其餘用「娘」。',
                examples: '老孃、爹孃、孃家、姑娘、娘子、婆娘、舞娘。'
            },
            {
                simplified: '僵',
                traditionalOptions: ['僵', '殭'],
                disambiguation: '「殭」意義為「不腐朽的屍體」，其餘用「僵」。',
                examples: '殭屍、殭蠶、僵硬、僵局、李代桃僵、百足之蟲，死而不僵。'
            },
            {
                simplified: '药',
                traditionalOptions: ['藥', '葯'],
                disambiguation: '「葯」特指「花的雄蕊中貯藏劃分的部份」，其餘用「藥」。',
                examples: '醫藥、良藥、芍藥、藥到病除、花葯。'
            },
            {
                simplified: '余',
                traditionalOptions: ['餘', '余'],
                disambiguation: '「余」為第一人稱代詞或地名。',
                examples: '剩餘、多餘、余吾鎮。'
            },
            {
                simplified: '蜡',
                traditionalOptions: ['蠟', '蜡'],
                disambiguation: '「蜡」只用於「蜡月」。',
                examples: '蠟燭、蜂蠟、石蠟、蜡月。'
            },
            {
                simplified: '出',
                traditionalOptions: ['出', '齣'],
                disambiguation: '「齣」只用於「一齣戲」。',
                examples: '出入、出道、一齣戲。'
            },
            {
                simplified: '卜',
                traditionalOptions: ['卜', '蔔'],
                disambiguation: '「蔔」只用於「蘿蔔」。',
                examples: '占卜、卜辭、蘿蔔。'
            },
            {
                simplified: '同',
                traditionalOptions: ['同', '衕'],
                disambiguation: '「衕」只用於「衚衕」。',
                examples: '大同、衚衕。'
            },
            {
                simplified: '板',
                traditionalOptions: ['板', '闆'],
                disambiguation: '「闆」只用於「老闆」。',
                examples: '板塊、老闆。'
            },
            {
                simplified: '漓',
                traditionalOptions: ['漓', '灕'],
                disambiguation: '「灕」只用於「灕江」。',
                examples: '大汗淋漓、淋漓盡致、灕江、灕水。'
            },
            {
                simplified: '術',
                traditionalOptions: ['術', '朮'],
                disambiguation: '「朮」僅用於中藥名「白朮」相關。',
                examples: '法術、白朮、兀朮。'
            },
            {
                simplified: '侖',
                traditionalOptions: ['侖', '崙'],
                disambiguation: '表示「崑崙」時用崙。',
                examples: '崑崙、加侖。'
            },
            {
                simplified: '秋',
                traditionalOptions: ['秋', '鞦'],
                disambiguation: '「鞦」只用於「鞦韆」。',
                examples: '秋季、鞦韆。'
            },
            {
                simplified: '千',
                traditionalOptions: ['千', '韆'],
                disambiguation: '「韆」只用於「鞦韆」。',
                examples: '千萬、鞦韆。'
            },
            {
                simplified: '帘',
                traditionalOptions: ['簾', '帘'],
                disambiguation: '表示旗幟狀的標識用「帘」。',
                examples: '窗簾、珠簾、酒帘。'
            },
            {
                simplified: '庵',
                traditionalOptions: ['庵', '菴'],
                disambiguation: '「菴」只用作「菴藹」，讀作an4。',
                examples: '尼姑庵、菴藹。'
            },
            {
                simplified: '尸',
                traditionalOptions: ['屍', '尸'],
                disambiguation: '「尸」表示「主持」、「佔用」。',
                examples: '屍體、尸位素餐。'
            },
            {
                simplified: '胡',
                traditionalOptions: ['胡', '衚', '鬍'],
                disambiguation: '「衚」只用於「衚衕」，「鬍」只用於「鬍鬚」。',
                examples: '胡人、胡亂、衚衕、鬍鬚。'
            },
            {
                simplified: '須',
                traditionalOptions: ['須', '鬚'],
                disambiguation: '「鬚」只用於「鬍鬚」。',
                examples: '必須、鬍鬚。'
            },
            {
                simplified: '據',
                traditionalOptions: ['據', '据'],
                disambiguation: '「据」只用於「拮据」。',
                examples: '數據、根據、拮据。'
            },
            {
                simplified: '筑',
                traditionalOptions: ['築', '筑'],
                disambiguation: '「筑」為古代一種樂器，其餘用「築」。',
                examples: '建築、築巢、擊筑。'
            },
            {
                simplified: '夸',
                traditionalOptions: ['誇', '夸'],
                disambiguation: '「夸」見於古文和專有名詞。',
                examples: '誇大、誇獎、夸父、夸克。'
            },
            {
                simplified: '苹',
                traditionalOptions: ['蘋', '苹'],
                disambiguation: '「苹」、「蘋」為兩種不同的植物。',
                examples: '蘋果、白蘋、苹縈、食野之苹。'
            },
            {
                simplified: '袅',
                traditionalOptions: ['裊', '嫋'],
                disambiguation: '與「嬌柔」、「婉轉」有關用「嫋」，其餘意義用「裊」。',
                examples: '嫋娜、餘音嫋嫋、裊繞。'
            },
            {
                simplified: '暗',
                traditionalOptions: ['暗', '闇'],
                disambiguation: '與「愚昧」有關意義用「闇」，其餘用「暗」。',
                examples: '闇昧、愚闇、偏信則闇、棄暗投明、暗號、暗示、黑暗。'
            },
            {
                simplified: '冲',
                traditionalOptions: ['衝', '沖', '冲'],
                disambiguation: '與「撞擊」有關用「衝」，與「水流」有關用「沖」，「冲」見於古文。',
                examples: '要衝、衝突、俯衝、沖牛奶。'
            },
            {
                simplified: '表',
                traditionalOptions: ['表', '錶'],
                disambiguation: '「錶」用作「鐘錶」，其餘用「表」。',
                examples: '表達、表示、代表、手錶。'
            },
            {
                simplified: '杆',
                traditionalOptions: ['杆', '桿'],
                disambiguation: '表示細長的棍狀物，「杆」讀音gan1，傾向於較大的，「桿」讀音gan3，傾向於較小的。',
                examples: '球杆、旗杆、電線杆、筆桿、杠桿、大腸桿菌。'
            },
            {
                simplified: '鑒',
                traditionalOptions: ['鑒', '鑑'],
                disambiguation: '用於「鏡子」、「圖章」意義時用「鑑」，其他引申意義均用「鑒」。',
                examples: '銅鑑、印鑑、借鑒、鑒定、明鑒、鑒賞、殷鑒不遠。'
            },
            {
                simplified: '搜',
                traditionalOptions: ['搜', '蒐'],
                disambiguation: '「搜」意義為「尋找」，與「聚集」和其他意義有關用「蒐」。',
                examples: '搜身、搜尋、蒐集、蒐羅、蒐購、春蒐。'
            },
            {
                simplified: '杯',
                traditionalOptions: ['杯', '盃'],
                disambiguation: '「盃」特別用於「獎盃」。',
                examples: '獎盃、冠軍盃、世界盃。'
            },
            {
                simplified: '鏟',
                traditionalOptions: ['剷', '鏟'],
                disambiguation: '「剷」用作動詞意義。',
                examples: '剷除、鏟子。'
            },
            {
                simplified: '扣',
                traditionalOptions: ['扣', '釦'],
                disambiguation: '「釦」表示衣服上的結。',
                examples: '鈕釦。'
            },
            {
                simplified: '念',
                traditionalOptions: ['念', '唸'],
                disambiguation: '與「讀」相近意義用「唸」。',
                examples: '唸書、唸經、思念、繫念。'
            },
            {
                simplified: '杠',
                traditionalOptions: ['杠', '槓'],
                disambiguation: '「杠」特別用於「牀杠」。',
                examples: '牀杠。'
            },
            {
                simplified: '泛',
                traditionalOptions: ['泛', '氾'],
                disambiguation: '表示「漂浮」「顯現」用「泛」，表示「大水」用「氾」。',
                examples: '廣泛、泛舟、泛藍、氾濫。'
            },
            {
                simplified: '核',
                traditionalOptions: ['核', '覈'],
                disambiguation: '與「校對」相關意義用「覈」。',
                examples: '覈實、覈對、覈算、考覈。'
            },
            {
                simplified: '巨',
                traditionalOptions: ['巨', '鉅'],
                disambiguation: '「鉅」與金屬有關，或用於固定名詞區別。',
                examples: '艱鉅、鉅變、鉅鹿、鉅款、鉅貪、鉅富、鉅子。'
            },
            {
                simplified: '嘆',
                traditionalOptions: ['嘆', '歎'],
                disambiguation: '悲傷有關用「嘆」，其他用「歎」。',
                examples: '哀嘆、感嘆、仰天長嘆、嘆息、嘆氣、吟歎、詠歎、歎爲觀止、歎羨、讚歎。'
            },
            {
                simplified: '价',
                traditionalOptions: ['價', '价'],
                disambiguation: '表示僕役用「价」。',
                examples: '小价、貴价、盛价、價格。'
            },
            {
                simplified: '私',
                traditionalOptions: ['私', '俬'],
                disambiguation: '俬：室內使用的器具。',
                examples: '傢俬。'
            },
            {
                simplified: '局',
                traditionalOptions: ['局', '侷'],
                disambiguation: '侷：表示「狹小」用「侷」。',
                examples: '大局、侷促、侷限。'
            },
            {
                simplified: '拐',
                traditionalOptions: ['拐', '柺'],
                disambiguation: '與「柺杖」有關用「柺」。',
                examples: '柺杖、鐵柺李、拐彎。'
            },
            {
                simplified: '弦',
                traditionalOptions: ['弦', '絃'],
                disambiguation: '「絃」專指樂器。',
                examples: '管絃、琴絃、續絃、箭在弦上、弦月。'
            },
            {
                simplified: '譁',
                traditionalOptions: ['譁', '嘩'],
                disambiguation: '擬聲詞用「嘩」。',
                examples: '嘩啦、譁然、喧譁、譁眾取寵。'
            },
            {
                simplified: '凄',
                traditionalOptions: ['悽', '淒'],
                disambiguation: '傾向於悲慘用「悽」，寒冷用「淒」。',
                examples: '淒涼、悽慘、悽楚、悽惻。'
            },
            {
                simplified: '家',
                traditionalOptions: ['家', '傢'],
                disambiguation: '「傢」為「家」某些意義的分化字。',
                examples: '傢俬、傢具、傢伙。'
            },
            {
                simplified: '席',
                traditionalOptions: ['席', '蓆'],
                disambiguation: '「蓆」特指涼蓆。',
                examples: '涼蓆、草蓆。'
            },
            {
                simplified: '酸',
                traditionalOptions: ['酸', '痠'],
                disambiguation: '肢體疼痛用「痠」。',
                examples: '痠痛、腰痠。'
            },
            {
                simplified: '噪',
                traditionalOptions: ['噪', '譟'],
                disambiguation: '壯大聲勢用「譟」。',
                examples: '鼓譟、譟詐、譟動、聒噪、噪音。'
            },
            {
                simplified: '咽',
                traditionalOptions: ['咽', '嚥'],
                disambiguation: '「嚥」用於「吞嚥」之意。',
                examples: '下嚥、嗚咽、咽喉。'
            },
            {
                simplified: '愈',
                traditionalOptions: ['愈', '癒'],
                disambiguation: '「癒」表示恢復。',
                examples: '癒合、治癒。'
            },
            {
                simplified: '凌',
                traditionalOptions: ['凌', '淩'],
                disambiguation: '「淩」作姓氏。',
                examples: '淩氏。'
            },
            {
                simplified: '毁',
                traditionalOptions: ['毀', '譭', '燬'],
                disambiguation: '與「燒」、「熔」有關用「燬」。\n「譭」表示「污衊」。',
                examples: '禁燬、燒燬、詆譭、譭譽參半、譭棄。'
            },
            {
                simplified: '苔',
                traditionalOptions: ['苔', '薹'],
                disambiguation: '「苔」為「附着在地面上的真菌藻類共生體」，「薹」為「中央部分所長出來的莖」。',
                examples: '青苔、苔原、苔藓、蒜薹、蕓薹、菜薹。'
            },
            {
                simplified: '糊',
                traditionalOptions: ['糊', '餬'],
                disambiguation: '「填飽肚子」用「餬」。',
                examples: '養家餬口。'
            },
            {
                simplified: '抵',
                traditionalOptions: ['抵', '牴'],
                disambiguation: '「牴」本意為「有角的獸類用角碰撞」，引申為「衝突」。',
                examples: '牴觸、牴牾。'
            },
            {
                simplified: '恤',
                traditionalOptions: ['恤', '卹'],
                disambiguation: '「卹」用作「撫慰」「賑濟」，「恤」用作「憂慮」「憐憫」。',
                examples: '體恤、憂國恤民、撫卹、卹金、振窮卹貧。'
            },
            {
                simplified: '荫',
                traditionalOptions: ['蔭', '廕'],
                disambiguation: '表示「庇護」「父祖恩澤」用「廕」。',
                examples: '廕庇、封妻廕子。'
            },
            {
                simplified: '皂',
                traditionalOptions: ['皁', '皂'],
                disambiguation: '「皂」專指肥皂。',
                examples: '香皂、皂莢樹、青紅皁白。'
            },
            {
                simplified: '芸',
                traditionalOptions: ['芸', '蕓'],
                disambiguation: '「蕓」只用作「蕓薹」。',
                examples: '蕓薹、蕓香。'
            },
            {
                simplified: '背',
                traditionalOptions: ['背', '揹'],
                disambiguation: '「揹」作動詞，表示「負荷」，讀陰平聲。',
                examples: '揹黑鍋、揹負。'
            },
            {
                simplified: '夫',
                traditionalOptions: ['夫', '伕'],
                disambiguation: '「伕」指「出苦力的人」。',
                examples: '車伕、轎伕、腳伕。'
            },
            {
                simplified: '迹',
                traditionalOptions: ['蹟', '跡'],
                disambiguation: '「蹟」特指「前人留下的事物」。',
                examples: '遺蹟、事蹟、奇蹟。'
            },
            {
                simplified: '買',
                traditionalOptions: ['买', '𧹒'],
                disambiguation: '𧹒：同「買」。宋元以來俗字譜：「買」，金瓶梅作「𧹒」。',
                examples: ''
            },
            {
                simplified: '么',
                traditionalOptions: ['麼', '麽'],
                disambiguation: '么：「麼」「麽」的简化字。《韻會》：「么」，俗「幺」字。',
                examples: ''
            },
        ];

        // 簡繁轉換數據 // 將這些數據移到 IIFE 外部，使其在全局範圍內可訪問
        const simToTradData = {
            '宫': ['宮'], '家': ['家', '傢'], '宽': ['寬'], '宾': ['賓'], '寝': ['寢'], '对': ['對'], '寻': ['尋'], '导': ['導'], '寿': ['壽'],'干': ['幹', '乾', '干'], '并': ['並', '併'], '离': ['離'], '私': ['私', '俬'], '秃': ['禿'], '秆': ['稈'], '秋': ['秋', '鞦'], '种': ['種', '种']
        };

        const tradToSimData = {
            '乾': ['干', '乾'], '亂': ['乱'], '亙': ['亘'], '亞': ['亚'], '佇': ['伫'], '佈': ['布'], '佔': ['占'], '併': ['并'], '來': ['来'], '侖': ['仑'], '侶': ['侣'], '侷': ['局'], '俁': ['俣'], '係': ['系'], '俓': ['𠇹'], '俔': ['伣'], '俠': ['侠'], '俥': ['伡'], '俬': ['私'], '倀': ['伥'], '倆': ['俩'], '倈': ['俫'], '倉': ['仓'], '個': ['个'], '們': ['们'], '倖': ['幸'], '倫': ['伦'], '倲': ['㑈'], '偉': ['伟'], '偑': ['㐽'], '側': ['侧'], '偵': ['侦'], '偽': ['伪'], '傌': ['㐷'], '傑': ['杰'], '傖': ['伧'], '傘': ['伞'], '備': ['备'], '傢': ['家']
        };

        // 異體字數組 - 這些字符在啟用異體字排除功能時不參與轉換
        const variantCharacters = new Set([
            '傢',  // 家具的「傢」
            '俬',  // 私人的「俬」
            '侷',  // 局限的「侷」
            '柺',  // 柺杖的「柺」
            '絃',  // 琴絃的「絃」
            '嘩',  // 嘩啦的「嘩」
            '悽',  // 悽慘的「悽」
            '淒',  // 淒涼的「淒」
            '蓆',  // 涼蓆的「蓆」
            '痠',  // 痠痛的「痠」
            '譟',  // 鼓譟的「譟」
            '嚥',  // 吞嚥的「嚥」
            '癒',  // 治癒的「癒」
            '淩',  // 姓氏淩
            '譭',  // 污衊的「譭」
            '燬',  // 燒燬的「燬」
            '薹',  // 蒜薹的「薹」
            '餬',  // 餬口的「餬」
            '牴',  // 牴觸的「牴」
            '卹',  // 撫卹的「卹」
            '廕',  // 廕庇的「廕」
            '皁',  // 青紅皁白的「皁」
            '蕓',  // 蕓薹的「蕓」
            '揹',  // 揹負的「揹」
            '伕',  // 車伕的「伕」
            '蹟'   // 遺蹟的「蹟」
        ]);

        (() => {
            // 2. 狀態管理
            let userRules = new Map(); // 用於儲存用戶自定義的轉換規則
            let fixedChoices = new Map(); // 儲存用戶已確定的轉換選擇，這些選擇不會被自動轉換覆蓋
            let lastConversionDirection = ''; // 儲存上次轉換的方向 ('toTrad' 或 'toSim')
            let excludeVariants = false; // 異體字排除功能啟用狀態

            // 撤銷/重做歷史
            let history = []; // 儲存應用狀態的陣列，用於實現撤銷和重做功能
            let historyIndex = -1; // 當前歷史狀態在 history 陣列中的索引

            // 3. DOM 元素引用
            const sourceText = document.getElementById('source-text'); // 原始文本輸入區域
            const btnToTrad = document.getElementById('btn-to-trad'); // 簡轉繁按鈕
            const btnToSim = document.getElementById('btn-to-sim'); // 繁轉簡按鈕
            const interactiveResult = document.getElementById('interactive-result'); // 互動式轉換結果顯示區域
            const finalResult = document.getElementById('final-result'); // 最終轉換結果顯示區域
            const resetBtn = document.getElementById('reset-btn'); // 重置所有規則按鈕
            const copyFinalResultBtn = document.getElementById('copy-final-result-btn'); // 複製最終結果按鈕
            const copyMessage = document.getElementById('copy-message'); // 複製成功提示訊息
            const clearSourceTextBtn = document.getElementById('clear-source-text-btn'); // 清空輸入文本按鈕
            const disambiguationNote = document.getElementById('disambiguation-note'); // 字義辨析註釋顯示區域
            const undoBtn = document.getElementById('undo-btn'); // 撤銷按鈕
            const redoBtn = document.getElementById('redo-btn'); // 重做按鈕
            const themeToggleBtn = document.getElementById('theme-toggle-btn'); // 主題切換按鈕
            const excludeVariantsCheckbox = document.getElementById('exclude-variants-checkbox'); // 異體字排除勾選框
            const body = document.body; // body 元素

            // 4. 輔助函數

            /**
             * 過濾異體字選項
             * 根據異體字排除功能的啟用狀態，從轉換選項中移除異體字
             * @param {Array} options 原始轉換選項數組
             * @param {boolean} isExcludeVariants 是否啟用異體字排除功能
             * @returns {Array} 過濾後的選項數組
             */
            function filterVariantCharacters(options, isExcludeVariants) {
                // 邊界情況檢查
                if (!isExcludeVariants || !Array.isArray(options) || options.length === 0) {
                    return options;
                }
                
                // 檢查異體字數組是否為空
                if (variantCharacters.size === 0) {
                    console.warn('異體字數組為空，異體字排除功能已禁用');
                    return options;
                }
                
                try {
                    const filtered = options.filter(char => {
                        if (typeof char !== 'string') {
                            console.warn(`無效的字符類型: ${typeof char}, 值: ${char}`);
                            return true; // 保留非字符串項目以避免破壞轉換
                        }
                        return !variantCharacters.has(char);
                    });
                    
                    // 如果過濾後沒有剩餘選項，保留原始選項以避免轉換失敗
                    if (filtered.length === 0) {
                        console.warn('過濾後無可用選項，保留原始選項:', options);
                        return options;
                    }
                    
                    return filtered;
                } catch (error) {
                    console.error('異體字過濾過程中發生錯誤:', error);
                    return options; // 發生錯誤時返回原始選項
                }
            }

            /**
             * 更新最終結果文本區的內容
             * 遍歷互動式結果區域的節點，將其內容組合成最終結果文本。
             */
            function updateFinalResult() {
                let result = ''; // 初始化最終結果字符串
                interactiveResult.childNodes.forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        // 如果是文本節點，直接追加其文本內容
                        result += node.textContent;
                    } else if (node.nodeType === Node.ELEMENT_NODE && node.tagName === 'SPAN') {
                        // 如果是固定選擇的 span 元素（綠色文字），追加其文本內容
                        result += node.textContent;
                    } else if (node.nodeType === Node.ELEMENT_NODE && node.tagName === 'SELECT') {
                        // 如果是下拉選單，獲取當前選中的字符
                        const selectedValue = node.value; // 例如："current:髮" 或 "global:发:髮"
                        const parts = selectedValue.split(':');
                        const charToAppend = parts[parts.length - 1]; // 最後一部分總是字符
                        result += charToAppend;
                    }
                });
                finalResult.value = result; // 將組裝好的結果設定為最終結果文本區的值
            }

            /**
             * 顯示字義辨析註釋
             * 根據傳入的字符，查找 characterDisambiguationData 並顯示相關的字義辨析和例詞。
             * @param {string} char 觸發註釋的字符（簡體或繁體）
             */
            function displayDisambiguationNote(char) {
                // 查找與當前字符匹配的字義辨析數據
                const data = characterDisambiguationData.find(item =>
                    item.simplified === char || (item.traditionalOptions && item.traditionalOptions.includes(char))
                );

                if (data) {
                    // 如果找到數據，使用更具語義的 HTML 標籤來顯示註釋
                    disambiguationNote.innerHTML = `
                    <h3>「${data.simplified}」：「${data.traditionalOptions.join('、')}」</h3>
                    <p><b>字義辨析：</b><br>${data.disambiguation.replace(/\n/g, '<br>')}</p>
                    <p class="examples"><b>例詞：</b><br>${data.examples.replace(/\n/g, '<br>')}</p>
                `;
                } else {
                    // 如果沒有找到數據，顯示無字義辨析的提示
                    disambiguationNote.innerHTML = `
                    <p>此字「${char}」無一對多字義辨析。</p>
                `;
                }
            }

            /**
             * 將當前應用狀態保存到歷史記錄中
             * 每次執行重要操作（如轉換、清空、應用規則）時調用。
             */
            function saveState() {
                // 如果當前索引不是歷史記錄的末尾，則清除所有後續的歷史記錄
                // 這意味著在執行新操作時，任何「重做」的歷史都會被刪除
                if (historyIndex < history.length - 1) {
                    history.splice(historyIndex + 1);
                }
                // 保存當前狀態的副本，包括原始文本、固定選擇、用戶規則、轉換方向和異體字排除狀態
                history.push({
                    sourceText: sourceText.value,
                    // 克隆 Map 以確保它們是獨立的副本，避免引用問題
                    fixedChoices: new Map(fixedChoices),
                    userRules: new Map(userRules),
                    direction: lastConversionDirection,
                    excludeVariants: excludeVariants
                });
                historyIndex++; // 更新歷史索引
                updateUndoRedoButtons(); // 更新撤銷/重做按鈕的啟用/禁用狀態
            }

            /**
             * 從歷史記錄中恢復指定索引的狀態
             * @param {number} index 要恢復的歷史狀態的索引
             */
            function restoreState(index) {
                if (index >= 0 && index < history.length) {
                    const state = history[index]; // 獲取指定索引的歷史狀態
                    sourceText.value = state.sourceText; // 恢復原始文本

                    // 清除並恢復 fixedChoices Map
                    fixedChoices.clear();
                    state.fixedChoices.forEach((v, k) => fixedChoices.set(k, v));

                    // 清除並恢復 userRules Map
                    userRules.clear();
                    state.userRules.forEach((v, k) => userRules.set(k, v));

                    lastConversionDirection = state.direction; // 恢復上次轉換方向
                    excludeVariants = state.excludeVariants || false; // 恢復異體字排除狀態
                    excludeVariantsCheckbox.checked = excludeVariants; // 同步勾選框狀態

                    // 重新執行轉換以更新 UI，但不保存此次操作到歷史記錄，避免無限循環
                    convertText(sourceText.value, lastConversionDirection, false);
                    disambiguationNote.innerHTML = '<h3>請點擊互動區中的紅色下拉選單，此處將顯示該字的簡繁一對多字義辨析。</h3>'; // 清空註釋
                    updateUndoRedoButtons(); // 更新按鈕狀態
                }
            }

            /**
             * 執行撤銷操作
             * 將應用狀態回溯到上一個歷史狀態。
             */
            function undo() {
                if (historyIndex > 0) {
                    historyIndex--; // 索引減一
                    restoreState(historyIndex); // 恢復上一個狀態
                }
            }

            /**
             * 執行重做操作
             * 將應用狀態前進到下一個歷史狀態。
             */
            function redo() {
                if (historyIndex < history.length - 1) {
                    historyIndex++; // 索引加一
                    restoreState(historyIndex); // 恢復下一個狀態
                }
            }

            /**
             * 更新撤銷和重做按鈕的啟用/禁用狀態
             * 根據當前歷史索引判斷是否可以撤銷或重做。
             */
            function updateUndoRedoButtons() {
                undoBtn.disabled = historyIndex <= 0; // 如果在歷史開頭，禁用撤銷
                redoBtn.disabled = historyIndex >= history.length - 1; // 如果在歷史末尾，禁用重做
            }

            // 4.5. 字符完整性驗證函數
            /**
             * 檢查字符是否為有效的Unicode字符
             * @param {string} char 要檢查的字符
             * @returns {boolean} 是否為有效字符
             */
            function isValidUnicodeChar(char) {
                return char.length > 0 && !isSurrogateHalf(char);
            }

            /**
             * 檢查字符是否為未配對的代理字符
             * @param {string} char 要檢查的字符
             * @returns {boolean} 是否為未配對的代理字符
             */
            function isSurrogateHalf(char) {
                if (char.length !== 1) return false;
                const code = char.charCodeAt(0);
                return code >= 0xD800 && code <= 0xDFFF;
            }

            /**
             * 驗證字符陣列的完整性
             * @param {Array} chars 字符陣列
             * @returns {boolean} 所有字符是否都有效
             */
            function validateCharacterIntegrity(chars) {
                return chars.every(char => isValidUnicodeChar(char));
            }

            /**
             * 處理字符轉換錯誤
             * @param {string} char 出錯的字符
             * @param {string} errorType 錯誤類型
             * @returns {string} 處理後的字符
             */
            function handleCharacterError(char, errorType) {
                switch (errorType) {
                    case 'SPLIT_ERROR':
                        console.warn(`字符拆分失敗: ${char}`);
                        break;
                    case 'SURROGATE_ERROR':
                        console.warn(`代理對錯誤: ${char}`);
                        break;
                    case 'MAPPING_NOT_FOUND':
                        // 正常情況，字符在對映表中不存在
                        break;
                    default:
                        console.warn(`未知錯誤: ${char}`);
                }
                return char; // 保持原字符
            }

            // 5. 主要轉換函數
            /**
             * 根據指定方向轉換文本並更新 UI
             * @param {string} text 要轉換的文本
             * @param {string} direction 轉換方向 ('toTrad' 或 'toSim')
             * @param {boolean} saveToHistory 是否將此操作保存到歷史記錄 (默認為 true)
             */
            function convertText(text, direction, saveToHistory = true) {
                interactiveResult.innerHTML = ''; // 清空互動式結果區域

                const conversionMap = direction === 'toTrad' ? simToTradData : tradToSimData; // 根據方向選擇轉換數據
                const originalChars = Array.from(text); // 將輸入文本拆分為字符陣列，正確處理4字節Unicode字符

                // 驗證字符完整性
                if (!validateCharacterIntegrity(originalChars)) {
                    console.warn('檢測到無效的Unicode字符，某些字符可能無法正確轉換');
                    // 過濾出有問題的字符進行詳細報告
                    const invalidChars = originalChars.filter(char => !isValidUnicodeChar(char));
                    invalidChars.forEach(char => {
                        console.warn(`無效字符: "${char}" (長度: ${char.length})`);
                    });
                }

                // 步驟 1：預先計算所有字符的初始解析狀態
                // 此陣列將保存在沒有下拉選單的情況下*將*顯示的字符，
                // 考慮固定選擇、用戶規則和一對一自動轉換
                const initialResolvedChars = new Array(originalChars.length); // 儲存每個字符的初步轉換結果
                const isResolvedByRule = new Array(originalChars.length).fill(false); // 追蹤是否由用戶規則解析

                // 第一遍：應用固定選擇和一對一轉換
                for (let i = 0; i < originalChars.length; i++) {
                    const char = originalChars[i];
                    if (fixedChoices.has(i)) {
                        // 如果字符已被用戶固定選擇，則使用固定值
                        initialResolvedChars[i] = fixedChoices.get(i);
                    } else if (excludeVariants && variantCharacters.has(char)) {
                        // 如果啟用異體字排除且原文字符本身是異體字，保持不變
                        initialResolvedChars[i] = char;
                    } else if (conversionMap[char] && conversionMap[char].length === 1) {
                        // 如果字符有一對一轉換規則，則自動轉換
                        initialResolvedChars[i] = conversionMap[char][0];
                    } else {
                        // 否則，暫時保持原字符（如果是多選項或無轉換）
                        initialResolvedChars[i] = char;
                    }
                }

                // 第二遍：使用第一遍的上下文應用用戶規則
                // 這很重要，因為用戶規則可以覆蓋一對一或預設字符
                for (let i = 0; i < originalChars.length; i++) {
                    const char = originalChars[i];
                    // 如果已被用戶固定，跳過規則應用但保留其狀態
                    if (fixedChoices.has(i)) {
                        // 固定選擇應被視為由規則解析，用於渲染目的
                        isResolvedByRule[i] = true;
                        continue; // 移動到下一個字符
                    }

                    // 獲取當前字符的前一個和後一個字符，用於上下文規則判斷
                    const prevChar = i > 0 ? initialResolvedChars[i - 1] : '';
                    const nextChar = i < originalChars.length - 1 ? (
                        fixedChoices.has(i + 1) ? fixedChoices.get(i + 1) : initialResolvedChars[i + 1]
                    ) : '';

                    // 定義各種規則鍵
                    const globalRuleKey = `char:${char}`;
                    const preContextRuleKey = `pre:${prevChar}${char}`;
                    const sucContextRuleKey = `suc:${char}${nextChar}`;
                    const contextRuleKey = `context:${prevChar}${char}${nextChar}`;

                    let ruleApplied = false; // 標記是否有規則被應用
                    if (prevChar && nextChar && userRules.has(contextRuleKey)) {
                        // 應用三字上下文規則
                        initialResolvedChars[i] = userRules.get(contextRuleKey);
                        ruleApplied = true;
                    } else if (prevChar && userRules.has(preContextRuleKey)) {
                        // 應用前置上下文規則
                        initialResolvedChars[i] = userRules.get(preContextRuleKey);
                        ruleApplied = true;
                    } else if (nextChar && userRules.has(sucContextRuleKey)) {
                        // 應用後置上下文規則
                        initialResolvedChars[i] = userRules.get(sucContextRuleKey);
                        ruleApplied = true;
                    } else if (userRules.has(globalRuleKey)) {
                        // 應用全局字符規則
                        initialResolvedChars[i] = userRules.get(globalRuleKey);
                        ruleApplied = true;
                    }
                    isResolvedByRule[i] = ruleApplied; // 標記此字符是否由用戶規則解析
                }

                // 步驟 2：基於 initialResolvedChars 構建互動結果
                // 並為多選項字符添加下拉選單
                for (let i = 0; i < originalChars.length; i++) {
                    const char = originalChars[i];
                    let resolvedChar = initialResolvedChars[i]; // 從預先計算的解析字符開始

                    // 如果是固定選擇或由用戶規則解析的字符，
                    // 將其渲染為固定的 span（綠色文字）
                    // 一對一自動轉換（非來自用戶規則）不會是綠色
                    if (fixedChoices.has(i) || isResolvedByRule[i]) {
                        const span = document.createElement('span'); // 創建 span 元素
                        span.className = 'fixed-choice'; // 添加固定選擇樣式類別
                        span.textContent = resolvedChar; // 設定文本內容
                        interactiveResult.appendChild(span); // 將 span 添加到互動式結果區域
                        continue; // 移動到下一個字符
                    }

                    // 如果是多選項字符，創建下拉選單
                    if (conversionMap[char] && conversionMap[char].length > 1) {
                        const options = conversionMap[char]; // 獲取所有轉換選項
                        const filteredOptions = filterVariantCharacters(options, excludeVariants); // 應用異體字過濾
                        const validOptions = [...new Set(filteredOptions)]; // 移除重複項
                        
                        // 如果過濾後只剩一個選項，直接轉換而不顯示下拉選單
                        if (validOptions.length === 1) {
                            interactiveResult.appendChild(document.createTextNode(validOptions[0]));
                            continue; // 移動到下一個字符
                        }
                        const select = document.createElement('select'); // 創建 select 元素
                        select.className = 'char-select'; // 添加一對多待選字樣式類別
                        select.dataset.originalChar = char; // 儲存原始字符
                        select.dataset.index = i; // 儲存字符索引
                        select.title = `點擊選擇「${char}」的轉換`; // 設定提示文字

                        // 添加焦點和失焦監聽器
                        select.addEventListener('focus', () => {
                            select.classList.add('is-focused'); // 聚焦時添加樣式
                            displayDisambiguationNote(char); // 顯示字義辨析
                        });
                        select.addEventListener('blur', () => {
                            select.classList.remove('is-focused'); // 失焦時移除樣式
                            select.style.width = ''; // 重置寬度
                            select.style.minWidth = ''; // 重置最小寬度
                            disambiguationNote.innerHTML = '<h3>請點擊互動區中的紅色下拉選單，此處將顯示該字的簡繁一對多字義辨析。</h3>'; // 清空註釋
                        });
                        select.addEventListener('change', (e) => {
                            const selectedType = e.target.value.split(':')[0];
                            if (selectedType === 'display') {
                                // 如果選中的是僅顯示選項，則將值還原並失焦
                                e.target.value = `display:${resolvedChar}`;
                                e.target.blur();
                                return;
                            }
                            select.blur(); // 選擇後失焦
                        });
                        select.addEventListener('click', (e) => {
                            e.stopPropagation(); // 阻止事件冒泡，避免觸發全局點擊事件
                        });

                        // 添加預設顯示選項
                        const defaultDisplayOption = document.createElement('option');
                        defaultDisplayOption.textContent = resolvedChar; // 顯示當前解析的字符
                        defaultDisplayOption.value = `display:${resolvedChar}`; // 值為 'display:字符'
                        select.appendChild(defaultDisplayOption);

                        // 添加明確的「當前」轉換選項
                        validOptions.forEach(optionChar => {
                            const opt = document.createElement('option');
                            opt.textContent = `當前「${char}」轉「${optionChar}」`; // 選項文本
                            opt.value = `current:${optionChar}`; // 值為 'current:字符'
                            select.appendChild(opt);
                        });

                        // 從 initialResolvedChars 獲取下拉選項的上下文
                        const prevCharForDropdownOptions = i > 0 ? initialResolvedChars[i - 1] : '';
                        const nextCharForDropdownOptions = i < originalChars.length - 1 ? initialResolvedChars[i + 1] : '';

                        if (prevCharForDropdownOptions) {
                            // 添加前置上下文規則選項
                            validOptions.forEach(optionChar => {
                                const opt = document.createElement('option');
                                opt.textContent = `全局「${prevCharForDropdownOptions}${char}」轉「${prevCharForDropdownOptions}${optionChar}」`;
                                opt.value = `pre:${prevCharForDropdownOptions}${char}:${optionChar}`;
                                select.appendChild(opt);
                            });
                        }

                        if (nextCharForDropdownOptions) {
                            // 添加後置上下文規則選項
                            validOptions.forEach(optionChar => {
                                const opt = document.createElement('option');
                                opt.textContent = `全局「${char}${nextCharForDropdownOptions}」轉「${optionChar}${nextCharForDropdownOptions}」`;
                                opt.value = `suc:${char}${nextCharForDropdownOptions}:${optionChar}`;
                                select.appendChild(opt);
                            });
                        }

                        if (prevCharForDropdownOptions && nextCharForDropdownOptions) {
                            // 添加三字上下文規則選項
                            validOptions.forEach(optionChar => {
                                const opt = document.createElement('option');
                                opt.textContent = `全局「${prevCharForDropdownOptions}${char}${nextCharForDropdownOptions}」轉「${prevCharForDropdownOptions}${optionChar}${nextCharForDropdownOptions}」`;
                                opt.value = `context:${prevCharForDropdownOptions}${char}${nextCharForDropdownOptions}:${optionChar}`;
                                select.appendChild(opt);
                            });
                        }

                        // 添加全局規則選項到下拉選單
                        validOptions.forEach(optionChar => {
                            const opt = document.createElement('option');
                            opt.textContent = `全局「${char}」轉「${optionChar}」`;
                            opt.value = `global:${char}:${optionChar}`;
                            select.appendChild(opt);
                        });

                        interactiveResult.appendChild(select); // 將下拉選單添加到互動式結果區域
                    } else {
                        // 不是多選項下拉選單的字符（無轉換或一對一轉換）
                        interactiveResult.appendChild(document.createTextNode(resolvedChar)); // 直接添加文本節點
                    }
                }

                updateFinalResult(); // 更新最終結果文本區
                if (saveToHistory) {
                    saveState(); // 如果需要，保存當前狀態到歷史記錄
                }
            }

            // 6. 事件監聽
            /**
             * 處理轉換按鈕點擊事件的通用函數
             * @param {string} direction 轉換方向 ('toTrad' 或 'toSim')
             */
            function handleConversion(direction) {
                lastConversionDirection = direction; // 儲存當前轉換方向
                convertText(sourceText.value, direction, true); // 每次轉換都保存狀態
            }

            btnToTrad.addEventListener('click', () => handleConversion('toTrad')); // 簡轉繁按鈕點擊事件
            btnToSim.addEventListener('click', () => handleConversion('toSim')); // 繁轉簡按鈕點擊事件

            // 異體字排除勾選框事件監聽
            excludeVariantsCheckbox.addEventListener('change', (event) => {
                excludeVariants = event.target.checked; // 更新異體字排除狀態
                
                // 如果有文本且已經進行過轉換，重新轉換以應用新設置
                if (sourceText.value && lastConversionDirection) {
                    convertText(sourceText.value, lastConversionDirection, true);
                }
            });

            interactiveResult.addEventListener('change', (event) => {
                const target = event.target; // 獲取觸發事件的元素
                if (target && target.tagName === 'SELECT' && target.value) {
                    const [type, ...rest] = target.value.split(':'); // 解析選中選項的值

                    // 如果選中的選項是僅顯示選項，則不執行任何操作
                    if (type === 'display') {
                        // select 元素本身的變更監聽器已經處理了值的還原
                        return;
                    }

                    const value = rest.pop(); // 獲取選中的轉換結果字符
                    const context = rest.join(':'); // 獲取上下文信息

                    const index = parseInt(target.dataset.index, 10); // 獲取字符索引
                    const originalChar = target.dataset.originalChar; // 獲取原始字符

                    if (type === 'current') {
                        // 將選擇固定下來，儲存到 fixedChoices Map
                        fixedChoices.set(index, value);

                        // 更新顯示（此處的 span 替換僅用於即時視覺反饋）
                        // 通過 convertText 的完整重新渲染將正確應用固定選擇樣式
                        const span = document.createElement('span');
                        span.className = 'fixed-choice';
                        span.textContent = value;
                        target.parentNode.replaceChild(span, target); // 將下拉選單替換為 span

                        // 重新轉換整個文本以更新前後字符，這將確保固定選擇被重視
                        convertText(sourceText.value, lastConversionDirection, true); // 保存狀態
                    } else {
                        let ruleKey;
                        if (type === 'pre' || type === 'suc' || type === 'context') {
                            // 根據類型構建上下文規則鍵
                            ruleKey = `${type}:${context}`;
                        } else if (type === 'global') {
                            // 構建全局字符規則鍵
                            ruleKey = `char:${originalChar}`;
                        }

                        if (ruleKey) {
                            userRules.set(ruleKey, value); // 將規則儲存到 userRules Map

                            // 重要：同時固定當前字符選擇以防止其恢復
                            fixedChoices.set(index, value);

                            // 重新轉換整個文本，已固定的選擇會優先顯示
                            convertText(sourceText.value, lastConversionDirection, true); // 保存狀態
                        }
                    }
                }
            });

            // 複製按鈕事件監聽
            copyFinalResultBtn.addEventListener('click', () => {
                finalResult.select(); // 選中 textarea 中的文本
                finalResult.setSelectionRange(0, 99999); // 兼容移動設備，選中所有文本

                try {
                    document.execCommand('copy'); // 嘗試複製文本到剪貼簿
                    copyMessage.classList.add('show'); // 顯示複製成功提示
                    setTimeout(() => {
                        copyMessage.classList.remove('show'); // 2秒後隱藏提示
                    }, 2000);
                } catch (err) {
                    console.error('複製失敗:', err);
                    // 可以在這裡添加一個更友好的錯誤提示
                }
                window.getSelection().removeAllRanges(); // 取消文本選中狀態
            });

            // 重置按鈕事件
            resetBtn.addEventListener('click', () => {
                userRules.clear(); // 清空用戶自定義規則
                fixedChoices.clear(); // 清空固定選擇
                convertText(sourceText.value, lastConversionDirection, true); // 重新轉換並保存狀態
                disambiguationNote.innerHTML = '<h3>請點擊互動區中的紅色下拉選單，此處將顯示該字的簡繁一對多字義辨析。</h3>'; // 清空註釋
            });

            // 清空輸入文字按鈕事件
            clearSourceTextBtn.addEventListener('click', () => {
                sourceText.value = ''; // 清空輸入文字區域
                userRules.clear(); // 清空用戶自定義規則
                fixedChoices.clear(); // 清空固定選擇
                interactiveResult.innerHTML = ''; // 清空互動式結果
                finalResult.value = ''; // 清空最終結果
                disambiguationNote.innerHTML = '<h3>請點擊互動區中的紅色下拉選單，此處將顯示該字的簡繁一對多字義辨析。</h3>'; // 清空註釋
                saveState(); // 保存清空後的狀態
            });

            // 撤銷和重做按鈕事件監聽
            undoBtn.addEventListener('click', undo); // 撤銷按鈕點擊事件
            redoBtn.addEventListener('click', redo); // 重做按鈕點擊事件

            // 添加全局點擊事件監聽器，確保點擊外部時選單正確關閉
            document.addEventListener('click', (e) => {
                // 查找所有當前處於焦點狀態的選單
                const focusedSelects = document.querySelectorAll('.char-select.is-focused');
                focusedSelects.forEach(select => {
                    // 如果點擊的不是這個選單本身，則移除焦點
                    if (!select.contains(e.target)) {
                        select.blur(); // 觸發失焦事件
                        select.classList.remove('is-focused'); // 移除聚焦樣式
                    }
                });
            });



            // 主題切換邏輯
            function toggleTheme() {
                if (body.classList.contains('dark-theme')) {
                    body.classList.remove('dark-theme');
                    localStorage.setItem('theme', 'light');
                } else {
                    body.classList.add('dark-theme');
                    localStorage.setItem('theme', 'dark');
                }
            }

            themeToggleBtn.addEventListener('click', toggleTheme);

            // 7. 初始設置
            // 頁面載入後，檢查 localStorage 中的主題偏好
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                body.classList.add('dark-theme');
            } else {
                // 預設為亮白主題，或者如果沒有儲存偏好，也設定為亮白
                body.classList.remove('dark-theme');
                localStorage.setItem('theme', 'light'); // 確保初始狀態被儲存
            }


        })();
    </script>
</body>

</html>